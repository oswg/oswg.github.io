!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e.SENTRY_RELEASE={id:"substack@af5f699"};var t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ccc9ab2a-3de4-45a0-b9aa-1618ab03bcdb",e._sentryDebugIdIdentifier="sentry-dbid-ccc9ab2a-3de4-45a0-b9aa-1618ab03bcdb")}catch(e){}}();"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["70636"],{80140:function(e,t,n){n.d(t,{A:()=>o});let o={footerButtons:"footerButtons-ap9Sk7",footerSubstackCta:"footerSubstackCta-v5HWfj",noIcon:"noIcon-z7v9D8",sizeSm:"sizeSm-F_aC8H",sizeSmNoIcon:"sizeSmNoIcon-KRHkpZ",getTheApp:"getTheApp-Yk3w1O",appUpsell:"appUpsell-ZCFh94"}},22065:function(e,t,n){n.d(t,{A:()=>o});let o={container:"container-PNh5cP",containerBulwark:"containerBulwark-Y0wz4B",noPodcasts:"noPodcasts-reia2s"}},41752:function(e,t,n){n.d(t,{u:()=>d});var o=n(4006),r=n(84605),i=n(25859),a=n(86500),s=n(58418),l=n(12387),c=n(76977),u=n(63136);function d(e){let{publicationId:t,subscriptionStatus:n,billingUrl:d,containerMaxWidth:m,paddingX:p,paddingY:_}=e,{iString:h}=(0,r.GO)(),y="".concat("past_due_alert_dismissed","_").concat(t),[b,g]=(0,s.A)(y,691200);return"past_due"!==n||b?null:(0,o.Y)(c.pT,{direction:"column",style:{width:"100%",maxWidth:null!=m?m:"min(100%, var(--container-max-width, 728px))",margin:"16px auto",boxSizing:"border-box"},paddingX:p,paddingY:_,children:(0,o.Y)(l.F,{theme:"error",description:(0,o.FD)(u.EY,{weight:"semibold",children:[h("We were unable to process your latest payment.")," ",(0,o.Y)(i.Yq,{href:d,decoration:"underline",onClick:()=>{(0,a.u4)(a.qY.PAST_DUE_ALERT_UPDATE_PAYMENT_CLICKED)},children:h("Update payment")})]}),showClose:!0,onDismiss:g})})}},49092:function(e,t,n){n.d(t,{Z:()=>ei});var o=n(4006),r=n(45994),i=n(15734),a=n.n(i),s=n(84605),l=n(35369),c=n(76977),u=n(16993),d=n(63136);let m=e=>{let{isOpen:t,onContinue:n}=e,{iString:i}=(0,s.GO)(),[a,m]=(0,r.J0)(!1);return(0,o.FD)(u.aF,{isOpen:t,children:[(0,o.Y)(u.rQ,{title:i("Switch to Bitcoin"),showClose:!1}),(0,o.Y)(u.cw,{children:(0,o.FD)(c.I1,{gap:24,children:[(0,o.FD)(c.I1,{gap:16,children:[(0,o.Y)(d.EY.B4,{translated:!0,children:"Switching to Bitcoin will end your auto-renewing credit card payments."}),(0,o.FD)(d.EY.B4,{translated:!0,children:["Please note that Substack cannot process refunds or auto-renewals for Bitcoin payments. You will now be sent to"," ",(0,o.Y)("a",{href:"https://opennode.com",target:"_blank",rel:"noopener",children:"OpenNode"})," ","to complete your checkout."]})]}),(0,o.Y)(l.$n,{onClick:()=>{m(!0),n()},disabled:a,children:i("Continue")})]})})]})};var p=n(66803),_=n(50180),h=n(32485),y=n.n(h),b=n(65842);let g="themed-qm5g5y",f=e=>{let{placeholder:t,maxLength:n,value:r,symbol:i,themed:a=!1,onChange:s}=e;return(0,o.FD)(c.Ye,{alignItems:"center",justifyContent:"start",className:y()("inputContainer-JJXl4U",{[g]:a}),children:[(0,o.Y)(d.EY.B3,{as:"span",color:a?"pub-secondary-text":"secondary",weight:"semibold",className:"currencyInput-n4aG03",children:i}),(0,o.Y)(b.ks,{name:"Confirm Founding Price","aria-label":"Confirm founding price",value:r,placeholder:t,maxLength:n,onChange:e=>s(e.currentTarget.value),onInput:e=>s(e.currentTarget.value),className:y()("inputField-ZlLLCs",{[g]:a})})]})};var v=n(86500),Y=n(82776);let w=e=>{let{currency:t,isValid:n,newUpgradeModal:i,planName:a,price:l,setValidationState:u}=e,[m,h]=(0,r.J0)(""),y=parseInt(l);(0,r.vJ)(()=>((0,v.u4)(v.qY.FOUNDING_PRICE_CONFIRMATION_REQUIRED,{price:l,source:"upgrade modal"}),()=>{n||(0,v.u4)(v.qY.FOUNDING_PRICE_CONFIRMATION_DISMISSED,{price:l,source:"upgrade modal"})}),[]);let{iString:b}=(0,s.GO)(),g=(0,Y.isZeroDecimalCurrency)(t)?1:100;return(0,o.FD)(c.I1,{font:i?"text":void 0,gap:8,paddingTop:8*!i,borderTop:i?void 0:"detail",alignItems:"start",justifyContent:"start",children:[(0,o.FD)(d.EY,{translated:!0,as:"p",size:i?14:17,color:"secondary",children:["Please confirm you want to pay"," ",(0,o.Y)(d.EY,{as:"span",color:"primary",weight:"semibold",children:I18N.p(y?(0,Y.centsToPriceString)(y*g,t):l)})," ","per year for a ",I18N.p(null!=a?a:b("Founding Member"))," subscription by typing the price below."]}),(0,o.FD)(c.Ye,{alignItems:"center",justifyContent:"start",gap:8,style:{width:"100%"},children:[(0,o.Y)(f,{placeholder:l,symbol:(0,Y.currencySymbol)(t),maxLength:l.length,value:m,themed:!1,onChange:e=>{e===l?(u(!0),h(e)):e!==m&&(u(!1),h(e))}}),n?(0,o.Y)(p.A,{size:24,style:{color:"var(--color-accent-fg-green)"}}):(0,o.Y)(_.A,{size:24,style:{color:"var(--color-accent-fg-red)"}})]})]})};var C=n(33031),P=n.n(C),I=n(69277),D=n(70408),A=n(79785),S=n(17402),x=n(97731);let F=e=>(0,o.Y)(x.A,(0,D._)((0,I._)({},e),{name:"WarningIcon",svgParams:{viewBox:"-2 -2 18 18"},children:(0,o.Y)("path",{d:"M8 0C3.582 0 0 3.582 0 8s3.582 8 8 8 8-3.582 8-8S12.418 0 8 0zM9 12H7v-2h2V12zM9 8H7V4h2V8z"})}));var N=n(66511),E=n(67734);function k(){let e=(0,A._)([" per ",""]);return k=function(){return e},e}function T(){let e=(0,A._)(["Amount must be greater than ",""]);return T=function(){return e},e}let M=e=>{var t;let{amount:n,currency:r,isSelected:i,outlineOnSelect:a,plan:l,usePer:c,showDuration:u=!0,disableInput:d=!1,className:m,disableWarning:p,onChangeAmount:_,truncateInterval:h=!1}=e,b=(0,S.useRef)(null),[g,f]=(0,S.useState)(!1),v=(0,S.useCallback)(e=>{_(e.toString().replace(/[^\d.]/g,""))},[_]);r||(r=l.currency),(0,S.useEffect)(()=>{let e=(0,E.oW)(l,r);f(!!(!p&&e&&null!==n&&r&&parseFloat(Number((0,Y.isZeroDecimalCurrency)(r)?n:100*Number(n)).toFixed(2))<e&&i))},[n,r,p,i,l]),(0,S.useLayoutEffect)(()=>{setTimeout(()=>{b.current&&(b.current.style.width="1px",b.current.style.width="".concat(b.current.scrollWidth,"px"),b.current.scrollLeft=0)},0)},[n,b]),(0,S.useEffect)(()=>{i&&(b.current.focus(),b.current.select())},[b,i]);let{iTemplate:w,iString:C}=(0,s.GO)(),P=h&&"year"===l.interval?"yr":h&&"month"===l.interval?"mo":l.interval;return(0,o.FD)("span",{className:y()("outlineWrapper-MqmfKS",m,{"outlineWrapperSelected-KXkgz5":a&&i,"outlineWrapperWithWarning-x5ALXu":g}),children:[(0,Y.centsToPriceString)(100,r).replace("1",""),(0,o.Y)("input",{disabled:d,ref:b,className:y()("amountInput-pcn7kh",{"amountInputDeselected-W75Nrd":!i}),id:"money-variable-amount",type:"text","aria-label":"founding member amount",autoComplete:"off",value:"string"==typeof n?n:l.amount/100,onKeyDown:e=>{"ArrowUp"===e.key?(v(Number(n||l.amount/100)+5),setTimeout(()=>{b.current.selectionStart=b.current.selectionEnd=b.current.value.length},0)):"ArrowDown"===e.key&&(!n||Number(n)>=5)&&(v(Number(n||l.amount/100)-5),setTimeout(()=>{b.current.selectionStart=b.current.selectionEnd=b.current.value.length},0))},onInput:e=>{v(e.target.value)}}),(0,o.Y)("input",{name:"amount",type:"hidden",value:"string"==typeof n?100*(Number(n)||0):l.amount}),u&&"forever"!==l.interval&&(c?w(k(),C(P)):"/".concat(C(P))),g&&(0,o.Y)("div",{className:"warningContainer-lQlVcA",children:(0,o.Y)(N.m_,{text:w(T(),(0,Y.centsToPriceString)(null!=(t=(0,E.oW)(l,r))?t:0,r)),children:(0,o.Y)(F,{stroke:"white",height:20,fill:"red",strokeWidth:1})})})]})};var B=n(93946),L=n(81929);let q=e=>{let{coupon:t,currency:n,foundingAmount:r,foundingName:i,isSelected:a,isCurrent:l,language:u,plan:m,onChangeAmount:p}=e,{iString:_}=(0,s.GO)(),h=null==t?void 0:t.include_founding_plans;return(0,o.FD)(c.fI,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.Y)(d.EY.B4,{weight:a?"semibold":"regular",children:(0,o.FD)(c.VP,{gap:4,children:[(0,o.Y)(d.EY,{children:i}),h?(0,o.Y)(c.VP,{gap:4,children:(0,o.Y)(d.EY.B4,{weight:"semibold",color:"secondary",children:(0,B.Ac)(m,{language:u,currency:n,discount:t?(0,D._)((0,I._)({},t),{loading:!1}):void 0,recurring:!0})})}):(0,o.Y)(M,{amount:r?r.toString():"",currency:n,isSelected:a,plan:m,usePer:!0,onChangeAmount:e=>{p(Number(e))}})]})}),l&&(0,o.Y)(L.vw,{priority:"secondary",children:_("Current")})]})},J=e=>{let{currency:t,coupon:n,plan:r,isCurrent:i,isSelected:a,language:l}=e,{iString:u}=(0,s.GO)();return(0,o.FD)(c.fI,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.Y)(d.EY.B4,{weight:a?"semibold":"regular",children:(0,B.Ac)(r,{currency:t,noTrial:!0,recurring:!0,language:l,discount:n?(0,D._)((0,I._)({},n),{loading:!1}):void 0})}),i&&(0,o.Y)(L.vw,{priority:"secondary",children:u("Current")})]})};var U=n(33727),O=n(95477),V=n(54584),z=n(27162);let R=e=>{let{coupon:t,currency:n,foundingAmount:r,foundingName:i,isCurrent:a,language:s,plan:l,isSelected:c,sub:u,onChangePlan:d,onChangeFoundingAmount:m}=e,p=(0,V.Ns)(t,u,l)?t:void 0;return(0,o.FD)(U.Z,{as:"label",direction:"row",alignItems:"center",gap:12,padding:16,radius:"sm",cursor:"pointer",pressable:"lg",outline:c?"accent":"detail",className:c&&"selected-Rkwzkv",children:[(0,o.Y)(O.s,{checked:c,name:"plan",value:l.id,onClick:e=>{d({planId:e.target.value})}}),(0,z.T)({plan:l})?(0,o.Y)(q,{coupon:p,currency:n,foundingAmount:r,foundingName:i,isCurrent:a,isSelected:c,language:s,plan:l,onChangeAmount:m}):(0,o.Y)(J,{currency:n,coupon:p,plan:l,isCurrent:a,isSelected:c,language:s})]})},K=e=>{let{coupon:t,currency:n,foundingAmount:r,foundingName:i,getIsCurrentPlan:a,language:s,plans:l,selectedPlanId:u,sub:d,onChangeFoundingAmount:m,onChangePlan:p}=e,_=P()(l,"amount").filter(e=>{var t;return!(null==(t=e.metadata)?void 0:t.bitcoin)}),h=null!=u?u:"";return(0,o.Y)(c.VP,{gap:12,flex:{desktop:"grow",mobile:"auto"},children:_.map(e=>(0,o.Y)(R,{coupon:t,currency:n,foundingAmount:r,foundingName:i,isCurrent:a(e),isSelected:e.id===h,language:s,plan:e,sub:d,onChangePlan:p,onChangeFoundingAmount:m}))})};var G=n(16074),W=n(16291),Z=n(56458);function Q(){let e=(0,A._)(["Enjoy ","% off for \n          ","\n          . Afterward, your subscription renews on "," at "]);return Q=function(){return e},e}let j=e=>{var t,n,r;let{coupon:i,currency:a,foundingAmount:l,foundingAmountLessThanMinimum:u,foundingName:m,hasChanges:p,sub:_,isNewPlanClassicFounding:h,newPlan:y}=e,{iString:b,iTemplate:g,language:f}=(0,s.GO)(),v=(0,Y.isZeroDecimalCurrency)(a)?1:100,w=Math.floor((e=>{if(!e.totalAmount)return 0;let t=e.totalAmount;if(e.discount){var n,o;(null==(n=e.discount.coupon)?void 0:n.percent_off)?t=Math.round(t*(1-e.discount.coupon.percent_off/100)):(null==(o=e.discount.coupon)?void 0:o.amount_off)&&(t=Math.max(0,t-e.discount.coupon.amount_off))}let r=Number(e.current_period_start),i=Math.round(Date.now()/1e3),a=Number(e.current_period_end)-r;return(1-(i-r)/a)*Number(t)})(_)),C=p&&y&&(!h||!u),P=b("n/a");if(C)if(h&&(null==i?void 0:i.include_founding_plans)){let e=null!=(n=(0,E.id)(y,a))?n:0;i.percent_off?e=Math.round(e*(1-(i.percent_off_precise||i.percent_off)/100)):i.amount_off&&(e=Math.max(0,e-i.amount_off)),e=Math.max(0,e-w),P=(0,Y.centsToPriceString)(e,a)}else if(h)P="".concat((0,Y.centsToPriceString)((null!=l?l:0)*v,a)," ").concat(b("per year"));else if(i){let e=null!=(r=(0,E.id)(y,a))?r:0;i.percent_off?e=Math.round(e*(1-(i.percent_off_precise||i.percent_off)/100)):i.amount_off&&(e=Math.max(0,e-i.amount_off)),e=Math.max(0,e-w),P=(0,Y.centsToPriceString)(e/100*v,a)}else P=(0,B.Ac)(y,{language:f,currency:a});let A=y?(0,B.Ac)(y,{language:f,currency:a}):null,S=(0,W.A)().add(Number(null==y?void 0:y.interval_count),null==y?void 0:y.interval).format("MMM D, YYYY");return(0,o.FD)(U.Z,{shadow:"none",gap:20,padding:16,children:[(0,o.FD)(c.Ye,{justifyContent:"space-between",children:[(0,o.Y)(d.EY.B3,{weight:"semibold",children:b("Summary")}),(0,o.FD)(d.EY.B4,{color:"secondary",children:[" ",null==i?void 0:i.name," "]})]}),(0,o.FD)("div",{className:"grid-NonZWA",children:[_.plan&&(0,o.FD)(o.FK,{children:[(0,o.Y)(d.EY.B4,{children:b("Current plan")}),(0,o.FD)(c.VP,{"data-testid":"upgrade-summary-current-plan",gap:4,children:[(0,o.Y)(d.EY.B4,{align:"right",children:(0,Z.Vr)({sub:_})?m:H({plan:_.plan,language:f,currency:a,discount:null==(t=_.discount)?void 0:t.coupon})}),(0,Z.Vr)({sub:_})&&(0,o.Y)(d.EY.B4,{color:"secondary",align:"right",children:(0,B.Ac)(_.plan,{language:f,currency:a})})]})]}),(0,o.Y)(d.EY.B4,{children:b("New plan")}),(0,o.Y)(c.VP,{"data-testid":"upgrade-summary-new-plan",gap:4,children:(0,o.Y)(d.EY.B4,{align:"right",weight:"regular",color:C?"primary":"secondary",children:y&&i&&C?(0,B.Ac)(y,{language:f,currency:a,discount:i?(0,D._)((0,I._)({},i),{loading:!1}):void 0}):P})}),i&&(0,o.FD)(o.FK,{children:[(0,o.FD)(c.VP,{"data-testid":"upgrade-summary-credit",children:[(0,o.Y)(d.EY.B4,{weight:"regular",children:b("Credit")}),(0,o.FD)(d.EY.B5,{weight:"regular",children:[(0,W.A)(1e3*Number(_.current_period_end)).diff((0,W.A)(),"days")," ",b("unused days")]})]}),(0,o.Y)(d.EY.B4,{"data-testid":"upgrade-summary-total",align:"right",color:C?"primary":"secondary",weight:"regular",children:(0,Y.centsToPriceString)(w/100*v,a)})]}),(0,o.Y)(G.c,{className:"table-divider-O5XQ7c"}),i?(0,o.FD)(o.FK,{children:[(0,o.Y)(d.EY.B4,{weight:"semibold",children:b("Charge today")}),(0,o.Y)(c.VP,{children:(0,o.Y)(d.EY.B4,{"data-testid":"upgrade-summary-total",align:"right",color:C?"primary":"secondary",weight:C?"semibold":"regular",children:P})})]}):(0,o.FD)(o.FK,{children:[(0,o.Y)(d.EY.B4,{weight:"semibold",children:b("Total")}),(0,o.Y)(d.EY.B4,{"data-testid":"upgrade-summary-total",align:"right",color:C?"primary":"secondary",weight:C?"semibold":"regular",children:P})]})]}),(null==i?void 0:i.allow_upgrades)&&i.percent_off&&"forever"!==i.duration&&(0,o.FD)(d.EY.B5,{color:"secondary",children:[g(Q(),Math.floor(i.percent_off),"repeating"===i.duration&&i.duration_in_months?"".concat(i.duration_in_months," months"):"your first payment",S),A]})]})},H=e=>{var t,n,o;let{plan:r,language:i,currency:a,discount:s}=e;return(null==(t=r.metadata)?void 0:t.founding)!=="yes"||s?(0,B.Ac)(r,{language:i,currency:a,discount:s}):null!=(o=null==(n=r.metadata)?void 0:n.short_description)?o:"Founding membership"};var $=n(85478),X=n(12501),ee=n(68349),et=n(41086);let en=e=>{var t,n;let{pub:o,sub:r}=e,i=(0,Z.QP)(o);if(!i)return 0;let a=(0,E.id)(i,r.currency),s=r.is_founding&&r.plan&&(0,Z.Vr)({sub:r})&&i.interval===r.plan.interval?(0,E.id)(r.plan,r.currency):null,l=(0,Y.isZeroDecimalCurrency)(null!=(t=r.currency)?t:"usd")?1:100;return(null!=(n=null!=s?s:a)?n:0)/l},eo=e=>{let{pub:t,sub:n}=e,o=null==n?void 0:n.plan;if(!o)return null;if((0,Z.Vr)({sub:n})){let e=(0,Z.QP)(t);if(e&&e.interval===o.interval)return e}return o},er=e=>{var t,n;let{plan:o,sub:r}=e;return!!o&&!!r.plan&&(!!(o.id===r.plan.id||(0,Z.Vr)({sub:r})&&(0,z.T)({plan:o})&&o.interval===r.plan.interval)||o.amount===r.plan.amount&&o.interval===r.plan.interval&&o.currency===r.plan.currency&&(null==(t=o.metadata)?void 0:t.bitcoin)===(null==(n=r.plan.metadata)?void 0:n.bitcoin))},ei=e=>{var t,n,i,p;let{isOpen:_,preselectedPlan:h,pub:y,sub:b,onClose:g}=e,{iString:f,language:C}=(0,s.GO)(),{getConfigFor:P}=(0,$.mJ)(),[I,D]=(0,r.J0)(!1),[A,S]=(0,r.J0)(eo({pub:y,sub:b})),[x,F]=(0,r.J0)(en({pub:y,sub:b})),[N,E]=(0,r.J0)(!1),[k,T]=(0,r.J0)(!1),[M,B]=(0,r.J0)(null),L=(0,r.Kr)(()=>(y.plans||[]).filter(e=>{if(y.disable_annual_subscriptions){var t;return"year"!==e.interval||(null==(t=e.metadata)?void 0:t.founding)}return!y.disable_monthly_subscriptions||"month"!==e.interval}),[y.plans]),q=L.some(e=>{var t;return null==(t=e.metadata)?void 0:t.bitcoin}),J=null!=(n=(0,Z.m4)(y))?n:"",U=null!=(i=b.currency)?i:"usd",O=(0,Y.isZeroDecimalCurrency)(U),R=O?1:100,G=A&&!er({plan:A,sub:b}),W=x!==en({pub:y,sub:b}),Q=G||W,H=parseFloat((x*R).toFixed(2))<(null!=(p=(0,Z.fP)({pub:y,currency:U}))?p:0),ei=A&&(0,z.T)({plan:A}),ea=ei&&W&&(null!=x?x:0)>=(O?1e6:1e4),es=!!(I||!Q||ea&&!N||ei&&H||M),el=!!(null==A||null==(t=A.metadata)?void 0:t.founding)&&P("founding_plan_upgrade_warning"),{result:ec}=(0,X.st)({pathname:"/api/v1/coupon/one",auto:!!(null==b?void 0:b.is_subscribed)}),eu=null==ec?void 0:ec.coupon;(0,r.vJ)(()=>{if(_&&h){if("yearly"===h){let e=L.find(e=>"year"===e.interval&&1===e.interval_count);e&&S(e)}else if("founding"===h){let e=(0,Z.QP)(y);e&&S(e)}}},[_,L,h,y]);let ed=(0,r.hb)(()=>{S(eo({pub:y,sub:b})),F(en({pub:y,sub:b}))},[y,b]),em=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&ed(),(0,v.u4)(v.qY.UPGRADE_PLAN_MODAL_DISMISSED,{plan:A}),g()},ep=async function(){let{quantity:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!A)return;D(!0);let t=x&&ei?x*R:void 0;if(ea&&!N)return void D(!1);try{var n;let o=await a().post("/api/v1/subscription/change_plan").send({planId:A.id,foundingAmount:t,quantity:e,token:(0,et.y)(window._preloads.original_url,"token")});(null==(n=o.body)?void 0:n.opennodePaymentUrl)?setTimeout(()=>{window.location.href=o.body.opennodePaymentUrl},30):(D(!1),alert(f("Success! You've changed your plan")),(0,v.u4)(v.qY.UPGRADE_PLAN_MODAL_SUBMITTED,{plan:A,amount:null!=t?t:null,couponId:null==eu?void 0:eu.id}),(0,et.y)("redirect")?(0,ee.V2)((0,et.y)("redirect"),{local_navigation:!1}):((0,ee.qm)("change_plan"),window.location.reload()))}catch(e){D(!1),B((0,ee.uX)(e))}};return L.length?(0,o.FD)("div",{children:[q&&(0,o.Y)(m,{isOpen:k,onContinue:()=>ep()}),(0,o.FD)(u.aF,{isOpen:_,testId:"upgrade-plan-modal",width:700,onClose:I?()=>{}:g,fullscreenMobile:!0,children:[(0,o.Y)(u.rQ,{title:f("Change plan"),onClose:g,showDivider:!0,showClose:!0}),(0,o.FD)(u.cw,{children:[(0,o.FD)(c.pT,{direction:{desktop:"row",mobile:"column"},gap:20,children:[(0,o.Y)(K,{currency:U,foundingAmount:x,foundingName:J,getIsCurrentPlan:e=>er({plan:e,sub:b}),language:C,plans:L,selectedPlanId:null==A?void 0:A.id,sub:b,coupon:eu,onChangeFoundingAmount:e=>{F(e),B(null),E(!1)},onChangePlan:e=>{let{planId:t}=e,{plans:n}=y,o=null==n?void 0:n.find(e=>e.id===t);o&&((0,v.u4)(v.qY.UPGRADE_PLAN_MODAL_PLAN_CHANGED,{oldPlan:A,newPlan:o,coupon:eu}),S(o),B(null))}}),(0,o.FD)(c.VP,{gap:40,flex:"grow",children:[(0,o.Y)(j,{currency:U,foundingAmount:x,foundingAmountLessThanMinimum:H,foundingName:J,hasChanges:Q,isNewPlanClassicFounding:!!ei,newPlan:A,sub:b,coupon:(0,V.Ns)(eu,b,null!=A?A:void 0)?eu:void 0}),ea&&(0,o.Y)(w,{price:x?x.toString():"",isValid:N,planName:J,currency:U,setValidationState:e=>{E(e),e&&(0,v.u4)(v.qY.FOUNDING_PRICE_CONFIRMATION_SUBMITTED,{price:x,source:"upgrade modal"})},newUpgradeModal:!0}),M&&(0,o.Y)(d.EY,{color:"error",size:14,font:"text",children:M})]})]}),el&&(0,o.Y)(c.pT,{padding:12,children:(0,o.Y)(d.EY.B3,{fontStyle:"italic",translated:!0,children:"Changing plan will charge you a prorated amount based on your current subscription"})})]}),(0,o.Y)(u.jl,{showDivider:!0,primaryButton:(0,o.Y)(l.$n,{priority:"primary",onClick:()=>{var e;(null==A||null==(e=A.metadata)?void 0:e.bitcoin)?(em(!1),T(!0)):ep()},loading:I,disabled:es,children:I?f("Loading..."):f("Change plan")}),secondaryButton:(0,o.Y)(l.$n,{priority:"secondary",onClick:()=>em(),loading:I,children:f("Cancel")})})]})]}):null}},58471:function(e,t,n){n.d(t,{k:()=>_});var o=n(4006),r=n(32485),i=n.n(r),a=n(24142),s=n(84605),l=n(76977),c=n(39318),u=n(98949),d=n(57324),m=n(34372),p=n(80140);let _=e=>{var t,n,r,_;let{user:h,size:y="md"}=e,{iString:b}=(0,s.GO)(),g=(0,u.Fr)(),f=(0,u.aR)(),v=(0,u.m0)(),Y=h&&!h.reader_installed_at,w=g&&(f||v)&&Y;return(0,o.FD)(l.fI,{alignItems:"center",justifyContent:"center",gap:8,className:p.A.footerButtons,children:[(0,o.FD)("a",{className:i()(p.A.footerSubstackCta,{[null!=(t=p.A.sizeSm)?t:""]:"sm"===y,[null!=(n=p.A.appUpsell)?n:""]:w}),"data-native":!0,href:(null==h?void 0:h.has_publication)?"".concat((0,c.$_T)({subdomain:"your"}),"/publish"):"".concat((0,c.Ewe)(),"/signup?").concat((0,c.BpC)({utm_source:d.VU.substack,utm_medium:d.Jn.web,utm_content:d.fL.footer})),children:[(0,o.Y)(a.A,{})," ",b("Start your Substack")]}),!w&&(0,o.Y)("a",{className:i()(p.A.footerSubstackCta,p.A.getTheApp,p.A.noIcon,{[null!=(r=p.A.sizeSm)?r:""]:"sm"===y,[null!=(_=p.A.sizeSmNoIcon)?_:""]:"sm"===y}),"data-native":!0,href:(0,c.wHz)({utm_campaign:d._9.appMarketing,utm_content:d.fL.webFooterButton}),children:b("Get the app")}),w&&(0,o.Y)("a",{className:m.A.appBadge,href:(0,c.wHz)({utm_campaign:d._9.appMarketing,utm_content:d.fL.webFooterButton,force:f?"ios":"android"}),children:(0,o.Y)("img",{className:p.A.appUpsell,src:f?(0,c.dJ9)("/img/app_page/app-store.png",320):(0,c.dJ9)("/img/app_page/google-play.png",320)})})]})}},2977:function(e,t,n){n.d(t,{A:()=>es});var o=n(69277),r=n(4006),i=n(32485),a=n.n(i),s=n(69843),l=n.n(s),c=n(98445),u=n(17402),d=n(15734),m=n.n(d),p=n(72170),_=n(82853),h=n(43954),y=n(6505),b=n(60745),g=n(49031),f=n(34581),v=n(70357),Y=n(38685),w=n(9979),C=n(84605),P=n(86500),I=n(35369),D=n(88774),A=n(8295),S=n(49807),x=n(57324);function F(e){let{pub:t,user:n}=e,{iString:o}=(0,C.GO)(),[i,a]=(0,u.useState)(!1),s=(0,S.$_T)(t),l={utm_source:x.VU.navbar,utm_medium:x.Jn.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},c=(0,S.yRP)(s,l),d=async()=>{(0,P.u4)(P.qY.PUBLICATION_SHARE_BUTTON_CLICKED)};return(0,r.FD)(r.FK,{children:[(0,r.FD)(D.W1,{trigger:(0,r.Y)(I.K0,{"aria-label":o("Share Publication"),priority:"tertiary",children:(0,r.Y)(p.A,{size:20})}),onOpen:d,children:[(0,r.FD)(D.H9,{isFirst:!0,children:[(0,r.Y)(D.Dr,{leading:(0,r.Y)(_.A,{}),onClick:()=>{(0,w.b3)({shareUrl:c,pub:t,utm_campaign:x._9.navbar})},children:o("Copy link")}),(0,r.Y)(D.Dr,{leading:(0,r.Y)(h.A,{}),onClick:()=>{(0,w.Et)({shareUrl:c,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:x._9.navbar})},children:o("Send as email")}),(0,r.Y)(D.Dr,{leading:(0,r.Y)(y.A,{}),onClick:()=>{(0,P.u4)(P.qY.SHARE_PUBLICATION_MODAL_OPENED),a(!0)},children:o("Get shareable images")})]}),(0,r.FD)(D.H9,{children:[(0,r.Y)(D.Dr,{leading:(0,r.Y)(v.A,{}),onClick:()=>{(0,w.HT)({shareUrl:c,pub:t,utm_campaign:x._9.navbar})},children:o("Share to Notes")}),(0,r.Y)(D.Dr,{leading:(0,r.Y)(g.A,{}),onClick:()=>{(0,w.aE)({shareUrl:c,pub:t,utm_campaign:x._9.navbar})},children:o("Share to Facebook")}),(0,r.Y)(D.Dr,{leading:(0,r.Y)(f.A,{}),onClick:()=>{(0,w.Uy)({shareUrl:c,pub:t,utm_campaign:x._9.navbar})},children:o("Share to Linkedin")}),(0,r.Y)(D.Dr,{leading:(0,r.Y)(b.A,{}),onClick:()=>{(0,w.PB)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:x._9.navbar})},children:o("Share to Bluesky")}),(0,r.Y)(D.Dr,{leading:(0,r.Y)(Y.A,{}),onClick:()=>{(0,w.NH)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:x._9.navbar})},children:o("Share to X")})]})]}),(0,r.Y)(A.gQ,{pub:t,isOpen:i,setOpen:a,item:{type:"pub_shareable_image"},width:718})]})}var N=n(13950),E=n(45197),k=n(51440),T=n(99145),M=n(53989),B=n(85478),L=n(1683),q=n(76583),J=n(68349),U=n(68410),O=n(17028),V=n(76977),z=n(81203),R=n(51177),K=n(36372),G=n(66511),W=n(38691),Z=n(57934),Q=n(40659),j=n(16291),H=n(56458),$=n(4016),X=n(96301),ee=n(39318),et=n(41086),en=n(82776);let eo=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:o}=(0,U.sM)(),{iString:i}=(0,C.GO)(),{onOpen:a,onClose:s}=(0,N.xF)();return(0,r.Y)(R.q7,{priority:"secondary",size:o?"sm":"md",additionalMenuProps:{onOpen:a,onClose:s},menuItems:n.map(e=>(0,r.Y)(D.Dr,{"data-native":!0,href:(0,S.Z96)(e,{addBase:!0,params:{utm_source:x.VU.substack,utm_content:x.fL.dashboardPubSwitcher}}),leading:(0,r.Y)(z.Nq,{size:24,radius:"xs",logoUrl:e.logo_url}),priority:t.subdomain===e.subdomain?"selected":"primary",children:e.name},e.id)),href:(0,S.Z96)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:i("Dashboard")})};function er(){let{iString:e}=(0,C.GO)(),t=(0,T.v9)();return(0,r.Y)(G.m_,{text:e("Search"),side:"bottom",children:(0,r.Y)(O.K0,{priority:"tertiary",onClick:()=>t.open(),children:(0,r.Y)(c.A,{size:20})})})}let ei=e=>{let{dashboardPubs:t,pub:n}=e,{iString:o}=(0,C.GO)(),{isMobile:i}=(0,U.sM)();return t.length>1?(0,r.Y)(eo,{pub:n,dashboardPubs:t}):(0,r.Y)(O.$n,{size:i?"sm":"md",priority:"secondary",href:(0,S.Z96)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:o("Dashboard")})};function ea(e){var t,n,i,a,s,c,u,d,p,_,h;let{user:y,pub:b,freeSignup:g,freeSignupEmail:f,hide_subscribe_cta:v,isMeetingsActive:Y,siteConfigContext:w,getSettingFor:C,renewing:I,renewed:D,setToRenew:A,language:F,isMobile:N}=e,{iString:E,iPlural:k}=I18N.i(F);b.invite_only&&!((null==y?void 0:y.subscription_id)||(null==y?void 0:y.is_free_subscribed))&&(v=!0);let T=(0,Q.rG)(),M=null==y?void 0:y.is_contributor,B=(null==y?void 0:y.is_subscribed)||M,q=(null==y?void 0:y.is_free_subscribed)||g,U=H.zN(b)&&B&&["gift","comp"].includes(null!=(a=y.subscription_type)?a:"")&&!(0,X.ZA)({pub:b,subscriptionType:null==y?void 0:y.subscription_type})&&(0,j.A)(y.subscription_expiry).subtract(30,"days").isBeforeNow(),V=H.zN(b)&&y&&H.cK(y)&&y.comp_expired_recently,z=(null==y?void 0:y.is_free_subscribed)&&(null==y?void 0:y.is_paused),R=(null==y?void 0:y.subscription_type)==="ios_app";if(M){let e=(null==y?void 0:y.dashboard_pubs)||[];return(0,r.Y)(ei,{dashboardPubs:e,pub:b})}if(z)return(0,r.Y)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,J.V2)((0,ee._nG)(b,{addBase:!0}),{local_navigation:!1})},children:E("Unpause my subscription")});if(U||V){if(!v)return(0,r.FD)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{var e;(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,J.V2)((0,ee.eV6)(b,{utm_source:x.VU.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,et.y)("referring_pub_ids"),addBase:!0,selectedPlanId:U&&(null==y?void 0:y.is_founding)&&b.plans?null==(e=b.plans.find(e=>{var t;return null==(t=e.metadata)?void 0:t.founding}))?void 0:e.id:null}),{local_navigation:!1})},children:[(0,r.Y)("span",{className:"mobile-only",children:E("Subscribe")}),(0,r.Y)("span",{className:"desktop-only",children:E("Continue your support")})]})}else if(H.zN(b)&&q&&!B&&!["thebulwark"].includes(b.subdomain)){if(!v)return(0,r.Y)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,J.V2)((0,ee.eV6)(b,{utm_source:x.VU.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,et.y)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,en.getSubscribeText)(b,{isFreeSubscribed:!0,isMobile:(0,J.rr)(),language:F})})}else if(H.zN(b)?B:q||B){if(b.invite_only&&B&&!l()(y.invites)&&y.invites<b.subscriber_invites)return(0,r.Y)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,J.V2)((0,ee.n_I)(b),{local_navigation:!1})},children:(0,r.Y)("span",{children:k("1 invite left","%1 invites left",b.subscriber_invites-y.invites)})});else if(H.zN(b)&&Y&&w&&!w.getConfigFor("hide_book_a_meeting_button"))return(0,r.FD)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,J.V2)((0,S.SJN)(b,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,r.Y)("span",{className:"mobile-only",children:E("Book meeting")}),(0,r.Y)("span",{className:"desktop-only",children:E("Book a meeting")})]});else if(H.zN(b)&&y&&y.is_subscribed&&!R&&y.subscription_unsubscribed_at&&!["gift","comp"].includes(null!=(s=y.subscription_type)?s:""))return(0,r.FD)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"renew"}),A()},disabled:I||D,style:{visibility:D?"hidden":"visible"},children:[(0,r.Y)("span",{className:"mobile-only",children:E("Renew")}),(0,r.Y)("span",{className:"desktop-only",children:E("Renew subscription")})]})}else if(!v){let e=null==(d=(0,et.y)("referring_pub_ids"))||null==(u=d.split)||null==(c=u.call(d,","))?void 0:c[0],t=null==(h=(0,et.y)("referring_pub_ids"))||null==(_=h.split)||null==(p=_.call(h,","))?void 0:p.slice(1);return(0,r.Y)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:async()=>{let n=y&&!y.is_magic&&y.email||f;if((0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:b.homepage_type}),n){let r;try{let i=await m().post("/api/v1/free").send((0,o._)({source:"menu",email:n,first_url:L.R9,first_referrer:L.b7,current_url:L.AT,current_referrer:L.uC,first_session_url:L.K0,first_session_referrer:L.OG,referring_pub_id:e,additional_referring_pub_ids:t},T));r=i.body.referral_token,(0,P.$5)(i.body.requires_confirmation)}catch(e){(0,P.u4)(P.qY.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,ee.eV6)(b,{utm_source:x.VU.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:r})}else window.location.href=(0,ee.eV6)(b,{utm_source:x.VU.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,et.y)("referring_pub_ids"),addBase:!0})},children:(0,en.getSubscribeText)(b,{isFreeSubscribed:q,isMobile:(0,J.rr)(),language:F})})}let K=(null==b||null==(i=b.plans)||null==(n=i.find(e=>{var t;return null==(t=e.metadata)?void 0:t.founding}))||null==(t=n.metadata)?void 0:t.short_description)==="Founding Member";if(H.zN(b)&&y&&!y.is_founding&&!R&&(0,j.A)(y.subscription_first_payment_at).isBefore((0,j.A)().subtract(48,"hours"))&&((0,$.s7)({pub:b})||"pinespayments"===b.subdomain||"citrini"===b.subdomain||K)){let e=(0,S.RKl)({pub:b,user:y,params:{utm_source:x.VU.menu,next:document.location.href}});return(0,r.FD)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,J.V2)(e,{local_navigation:!1})},children:[(0,r.Y)("span",{className:"mobile-only",children:E("Upgrade")}),(0,r.Y)("span",{className:"desktop-only",children:E(K?"Upgrade to founding":"Upgrade")})]})}return"disabled"===b.payments_state&&!b.invite_only&&C("payment_pledges_enabled")&&q&&!(null==y?void 0:y.is_pledged)?(0,r.Y)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,J.V2)((0,ee.eV6)(b,{utm_source:x.VU.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:E("Pledge your support")}):H.zN(b)&&!b.invite_only?(0,r.FD)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,J.V2)(y&&(null==w?void 0:w.getConfigFor("enable_founding_gifts"))?(0,$.eh)({user:y}):(0,ee.eV6)(b,{utm_source:x.VU.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,r.Y)("span",{className:"mobile-only",children:E("Give gift")}),(0,r.Y)("span",{className:"desktop-only",children:E("Gift a subscription")})]}):!b.is_on_substack||(null==y?void 0:y.has_publication)?null:(0,r.Y)(O.$n,{"data-testid":"noncontributor-cta-button",size:N?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,J.V2)((0,ee.f5H)({utm_source:x.VU.menu}),{local_navigation:!1})},children:E("Start publishing")})}let es=e=>{let{className:t,fixedTooltip:n=!0,freeSignup:o,freeSignupEmail:i,hideCta:s,hideNotifications:l,hideChat:c,hideSearch:d,hideShare:p,hideUserIndicator:_,hide_subscribe_cta:h,isMeetingsActive:y,pub:b,showCustomerSupportModeModal:g,user:f}=e,{iString:v,language:Y}=(0,C.GO)(),{isMobile:w}=(0,U.sM)(),{getSettingFor:P}=(0,M.Pu)(),[I,D]=(0,u.useState)(!1),[A,S]=(0,u.useState)(!1),x=(0,K.d)(),{enableCustomerServiceMode:N,disableCustomerServiceMode:T,modalElement:L}=(0,q.UU)({showCustomerSupportModeModal:g}),O=async()=>{D(!0);try{await m().post("/api/v1/subscription/reactivate").send({}),S(!0),x.popToast(()=>(0,r.Y)(K.y,{text:v("Your subscription has been renewed!")}))}catch(e){console.error("Failed to set to renew:",e),alert((0,J.uX)(e))}finally{D(!1)}};return(0,r.FD)(V.Ye,{alignItems:"center",gap:w?4:8,className:a()("navbar-buttons",t),justifyContent:"end",children:[(0,r.Y)(B.W8.Consumer,{children:e=>(0,r.Y)(k.U6.Consumer,{children:t=>(0,r.FD)(r.FK,{children:[!w&&!f&&(0,r.FD)(V.Ye,{gap:4,children:[!d&&(0,r.Y)(er,{}),!p&&(0,r.Y)(F,{pub:b,user:null!=f?f:void 0})]}),!w&&f&&(0,r.FD)(V.Ye,{gap:4,children:[!d&&(0,r.Y)(er,{}),c?!p&&(0,r.Y)(F,{pub:b,user:f}):(0,r.Y)(W.a,{}),!l&&(0,r.Y)(Z.S,{canShowAlerts:!b})]}),!s&&(0,r.Y)(ea,{pub:b,user:f,freeSignup:o,freeSignupEmail:i,hide_subscribe_cta:h,localeContext:t,siteConfigContext:e,isMeetingsActive:y,getSettingFor:P,renewing:I,renewed:A,setToRenew:O,language:Y,isMobile:w}),!_&&(0,r.Y)(E.Ay,{pub:b,user:f,enableCustomerServiceMode:N,disableCustomerServiceMode:T,fixedTooltip:n})]})})}),L]})}},85048:function(e,t,n){n.d(t,{Gf:()=>_,Nf:()=>u,qd:()=>c});var o=n(4006),r=n(41196),i=n(84605),a=n(63136),s=n(80856);function l(e,t){return[...Array(2*e.length-1)].map((n,o)=>o%2?t:e[o/2])}let c=e=>{let{publication:t,className:n,themed:r=!1,utm_source:i}=e,a=r?"pub-tertiary-text":"tertiary";switch(null==t?void 0:t.subdomain){case"activisionblizzard":return(0,o.Y)(m,{className:n,color:a,utm_source:i});case"demographyunplugged":return(0,o.Y)(p,{className:n,color:a,utm_source:i});default:return(0,o.Y)(d,{pub:t,className:n,color:a,utm_source:i})}},u=e=>{let{publication:t}=e,{iString:n}=(0,i.GO)();if((null==t?void 0:t.subdomain)==="demographyunplugged")return(0,o.FD)(o.FK,{children:[(0,o.FD)(a.EY,{translated:!0,size:14,className:"tos",children:["Substack's ",(0,o.Y)(r.o,{href:(0,s.gB)(),children:"Privacy"}),","," ",(0,o.Y)(r.o,{href:(0,s.lk)(),children:"Terms"})," and"," ",(0,o.Y)(r.o,{href:(0,s.iQ)(),children:"Information Collection Notice"})]}),(0,o.FD)(a.EY,{translated:!0,size:14,className:"tos",children:["Demography Unplugged's"," ",(0,o.Y)(r.o,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy"})," and"," ",(0,o.Y)(r.o,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms"})]})]});let c=[(0,o.Y)(r.o,{href:(0,s.gB)(),children:n("Privacy")}),(0,o.Y)(r.o,{href:(0,s.lk)(),children:n("Terms")}),(0,o.Y)(r.o,{href:(0,s.iQ)(),children:n("Collection notice")})];return(null==t?void 0:t.subdomain)==="activisionblizzard"&&c.push((0,o.FD)(o.FK,{children:["Activision's"," ",(0,o.Y)(r.o,{href:"https://www.activisionblizzard.com/legal/privacy-policy",children:"Privacy Policy"})]})),(null==t?void 0:t.subdomain)==="demographyunplugged"&&(c.push((0,o.FD)(o.FK,{children:["Demography Unplugged's"," ",(0,o.Y)(r.o,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy Policy"})]})),c.push((0,o.FD)(o.FK,{children:["Demography Unplugged's"," ",(0,o.Y)(r.o,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms"})]}))),(0,o.Y)(o.FK,{children:l(c,(0,o.Y)("span",{children:" ∙ "}))})},d=e=>{let{pub:t,className:n,color:i,utm_source:l}=e,c=null;return t.has_custom_tos&&t.has_custom_privacy?c=(0,o.FD)(a.EY.B4,{as:"span",translated:!0,children:["the publisher's ",(0,o.Y)(r.o,{href:(0,s.Ru)({pub:t,utm_source:l}),children:"Terms of Service"})," and"," ",(0,o.Y)(r.o,{href:(0,s._)({pub:t,utm_source:l}),children:"Privacy Policy"})]}):t.has_custom_tos?c=(0,o.FD)(a.EY.B4,{as:"span",translated:!0,children:["the publisher's ",(0,o.Y)(r.o,{href:(0,s.Ru)({pub:t,utm_source:l}),children:"Terms of Service"})]}):t.has_custom_privacy&&(c=(0,o.FD)(a.EY.B4,{as:"span",translated:!0,children:["the publisher's ",(0,o.Y)(r.o,{href:(0,s._)({pub:t,utm_source:l}),children:"Privacy Policy"})]})),(0,o.Y)(a.EY.B4,{color:i,className:null!=n?n:"tos",children:(0,o.Y)(r.b,{publisherTerms:c,utm_source:l})})},m=e=>{let{className:t,color:n,utm_source:i}=e;return(0,o.FD)(a.EY.B3,{translated:!0,size:14,color:n,className:null!=t?t:"tos",children:["By registering you agree to Substack's"," ",(0,o.Y)(r.o,{href:(0,s.lk)({utm_source:i}),children:"Terms of Service"}),", our"," ",(0,o.Y)(r.o,{href:(0,s.gB)({utm_source:i}),children:"Privacy Policy"}),", our"," ",(0,o.Y)(r.o,{href:(0,s.iQ)({utm_source:i}),children:"Information Collection Notice"}),", and Activision's"," ",(0,o.Y)(r.o,{href:"https://www.activisionblizzard.com/legal/privacy-policy",children:"Privacy Policy"})]})},p=e=>{let{className:t,color:n,utm_source:i}=e;return(0,o.FD)("div",{className:null!=t?t:"tos",children:[(0,o.FD)(a.EY.B3,{translated:!0,size:14,color:n,children:["By registering you agree to Substack's"," ",(0,o.Y)(r.o,{href:(0,s.lk)({utm_source:i}),children:"Terms of Service"}),", our"," ",(0,o.Y)(r.o,{href:(0,s.gB)({utm_source:i}),children:"Privacy Policy"}),", our"," ",(0,o.Y)(r.o,{href:(0,s.iQ)({utm_source:i}),children:"Information Collection Notice"}),"."]}),(0,o.FD)(a.EY.B3,{translated:!0,size:14,color:n,children:["You also agree to receive marketing emails from Hedgeye Risk Management, LLC pursuant to its"," ",(0,o.Y)(r.o,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy Policy"})," and"," ",(0,o.Y)(r.o,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms of Service"}),"."]}),(0,o.Y)(a.EY.B3,{translated:!0,size:14,color:n,children:"You may unsubscribe at any time by clicking the unsubscribe link in one of the emails."})]})},_=e=>{let{pub:t}=e,n=[];return t.has_custom_privacy&&n.push((0,o.Y)(r.o,{href:(0,s._)({pub:t}),children:"Publisher Privacy"})),t.has_custom_tos&&n.push((0,o.Y)(r.o,{href:(0,s.Ru)({pub:t}),children:"Publisher Terms"})),(0,o.Y)(o.FK,{children:l(n,(0,o.Y)("span",{children:" ∙ "}))})}},51419:function(e,t,n){n.d(t,{WJ:()=>l,eG:()=>c});var o=n(4006),r=n(17402);let i={name:null,version:null,major:null},a={chrome:130,firefox:130,safari:16,edge:130},s=(0,r.createContext)({browser:i,isSupported:!0,webviewPlatform:null});function l(e){let{browser:t=i,webviewPlatform:n=null,children:l}=e,c=(0,r.useMemo)(()=>{let{name:e,version:o,major:r}=t,i=!0,s=a[null==e?void 0:e.toLowerCase()];return e&&s&&(i=!!(o&&r&&Number(r)>=s)),{browser:t,isSupported:i,webviewPlatform:n}},[t,n]);return(0,o.Y)(s.Provider,{value:c,children:l})}function c(){return(0,r.useContext)(s)}},89195:function(e,t,n){n.d(t,{w:()=>_});var o=n(4006),r=n(32485),i=n.n(r),a=n(17402),s=n(58471),l=n(23044);n(73164);var c=n(56778);n(84605);var u=n(98747),d=n(86500),m=n(63136),p=n(39318);n(93699),n(80856);let _=(0,a.memo)(e=>{let{publication:t,user:n,path:r,hideTerms:a,showIntrinioAttrib:l}=e;void 0===a&&(a=!1);let _=(0,u.oY)();return(0,o.FD)("div",{className:"footer-wrap publication-footer",children:[(0,o.Y)(c.A,{onVisible:()=>{var e;(0,d.u4)(d.qY.PUBLICATION_FOOTER_SEEN,{publication_id:null==t?void 0:t.id,user_id:null==n?void 0:n.id,source:(e=r)?"/"===e?"pub-homepage":e.startsWith("/p")?"pub-post":e:"unknown"})}}),(0,o.Y)("div",{className:i()("footer",{"themed-background":_}),children:(0,o.FD)("div",{className:"container",children:[(0,o.Y)(h,{pub:t,hideTerms:a,showIntrinioAttrib:null!=l&&l}),(0,o.Y)(s.k,{user:n}),(0,o.FD)(m.EY,{translated:!0,as:"div",className:"footer-slogan-blurb",children:[(0,o.Y)("a",{href:"".concat((0,p.Ewe)()),"data-native":!0,children:"Substack"})," ","is the home for great culture"]})]})})]})}),h=e=>{let{pub:t,hideTerms:n,showIntrinioAttrib:r}=e;return(0,l.PG)(t)?(0,o.FD)("div",{className:"footer-terms",children:[(0,o.FD)("div",{className:"footer-terms-row",children:[(0,o.Y)(l.d_,{pub:t}),!n&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.P0,{pub:t})]})]}),(0,o.FD)("div",{className:"footer-terms-row",children:[(0,o.Y)("span",{children:"Substack"}),r&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.kz,{})]}),!n&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.vA,{pub:t})]})]})]}):(0,o.FD)("div",{className:"footer-terms",children:[(0,o.Y)(l.d_,{pub:t}),r&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.kz,{})]}),!n&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.vA,{pub:t})]})]})}},62668:function(e,t,n){n.d(t,{d:()=>o});let o=(0,n(17402).createContext)(!1)},94328:function(e,t,n){n.d(t,{LM:()=>b,b_:()=>f,u8:()=>g});var o=n(4006),r=n(87677),i=n(17402),a=n(32999),s=n(84605),l=n(27749),c=n(2675),u=n(67024),d=n(75840),m=n(68349),p=n(75303),_=n(81929),h=n(504),y=n(8791);let b=()=>{let{iString:e}=(0,s.GO)();return(0,o.Y)(_.vw,{theme:"error",priority:"primary",className:y.A.livePill,children:e("LIVE")})},g=e=>{let{viewerCount:t}=e;return(0,o.Y)(_.Jq,{priority:"primary",leading:(0,o.Y)(a.A,{size:18}),children:(0,u.q)(t)})},f=e=>{let{item:t,pub:n,post:a,onViewEpisodeClick:u}=e,{iString:p}=(0,s.GO)(),y=(0,c.vZ)({post:a,publication:n,urlParams:{autoPlay:"true"}}),b=(0,l.PK)(),g=(0,i.useContext)(d.P);return(0,o.Y)(_.Jq,{priority:"primary",onClick:e=>{null===m.dO||void 0===m.dO||m.dO.emit("play",{}),t&&(0,h.Qb)(t,b,"watch_full_episode",{tabId:g}),null==u||u(),y(e)},trailing:(0,o.Y)(r.A,{size:16}),children:p("View full episode")})};(0,p.I4)({display:"flex",direction:"row",gap:8,alignItems:"center",className:y.A.viewerCountContainer})},3479:function(e,t,n){n.d(t,{j2:()=>l});var o=n(86500);let r=["sort"],i=["sort","selection"],a=[];function s(e,t){let n;try{n=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){n=new URL(e)}for(let e of n.searchParams.keys())(t?i:r).includes(e)||n.searchParams.delete(e);return n.toString()}function l(e){setTimeout(()=>(function(e){var t,n;let{previous:r,url:i}=e;if("undefined"==typeof window)return;let l=s(i,!1),c=s(i,!0),{head:u}=document;null==(t=u.querySelector("link[rel=canonical]"))||t.setAttribute("href",l),null==(n=u.querySelector('meta[property="og:url"]'))||n.setAttribute("content",c),a.push(i),setTimeout(()=>{(0,o.YT)({previous:r,url:i})},100)})(e),0)}},76583:function(e,t,n){n.d(t,{UU:()=>p});var o=n(4006),r=n(17402),i=n(36339),a=n(25006),s=n(46271),l=n(94729),c=n(68349),u=n(16993),d=n(39318),m=n(41086);function p(){var e;let{showCustomerSupportModeModal:t,allowAllDay:n,allowClose:p}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=(0,a.df)(),h=(0,s.Jd)(),{canTurnOnCustomerSupportMode:y,isInCustomerSupportMode:b}={canTurnOnCustomerSupportMode:!!(null==(e=(0,s.Jd)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},[g,f]=(0,r.useState)(!!(t&&y)),v=async()=>{try{await (0,l.x6)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,c.uX)(e))}},Y=async()=>{if(null==_?void 0:_.custom_domain){let e=window.location.pathname;(0,c.V2)((0,d.oMA)(e,_),{local_navigation:!1})}else f(!0)},w=y&&(0,o.Y)(u.aF,{isOpen:g,onClose:p?()=>f(!1):void 0,children:(0,o.Y)(i.A,{redirect:(0,m.y)("redirect")||"/publish/home",onClose:()=>f(!1),requiresMfa:null==h?void 0:h.requires_global_admin_mfa_challenge,allowAllDay:n,allowClose:p})});return{enableCustomerServiceMode:y?Y:void 0,disableCustomerServiceMode:b?v:void 0,modalElement:w}}},51190:function(e,t,n){n.d(t,{X:()=>N});var o=n(4006),r=n(32485),i=n.n(r),a=n(24713),s=n.n(a),l=n(33031),c=n.n(l),u=n(48635),d=n(72880),m=n(84605),p=n(86500),_=n(68410),h=n(89490),y=n(35369),b=n(76977),g=n(63136),f=n(49807);let v=e=>{var t;let{label:n,openInNewTab:r,podcastSettings:a,section:s,sectionUrl:l,setupUrl:c,subscribeUrl:v,trackingSource:Y,user:C}=e,{iString:P}=(0,m.GO)(),{isMobile:I}=(0,_.sM)(),D=I?80:160,A=(0,h.iF)({radius:"md",width:D}),S=(null==C?void 0:C.is_subscribed)&&null!=(t=a.paidEpisodeArtUrl)?t:a.artUrl;return(0,o.FD)(b.Ye,{direction:I?"column":"row",gap:I?12:24,children:[S&&(0,o.Y)(d.o,{className:i()(A),src:(0,f.dJ9)(S,2*D),maxWidth:D,useRetinaSizing:!0,imageIsFixedWidth:!0}),(0,o.FD)(b.I1,{gap:8,children:[(0,o.FD)(b.Ye,{alignItems:"center",justifyContent:"space-between",children:[(0,o.Y)(g.EY.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",weight:"bold",href:l,rel:"noopener noreferrer",target:"_blank",children:a.title}),c&&(0,o.Y)(y.$n,{priority:"secondary",size:"sm",href:c,newTab:r,onClick:()=>{(0,p.u4)(p.qY.SET_UP_FEED_CLICKED,{section_id:s.id,source:Y})},children:P("Set up")})]}),n&&(0,o.FD)(b.Ye,{gap:8,alignItems:"center",children:[(0,o.Y)(w,{label:n}),"free-with-ads"===n&&v&&(0,o.Y)(g.EY,{className:"listenLink-UqdzU4",color:"accent",font:"text",size:12,onClick:()=>{(0,p.u4)(p.qY.LISTEN_AD_FREE_CLICKED,{section_id:s.id,source:Y}),r?window.open(v,"_blank","noopener,noreferrer"):window.location.href=v},children:"Listen ad-free"})]}),(0,o.Y)(g.EY.B3,{color:"pub-secondary-text",font:"text",children:a.description}),(0,o.Y)("div",{children:(0,o.FD)(g.EY,{alignItems:"center",color:"accent",display:"inline-flex",font:"text",size:14,weight:"medium",gap:8,onClick:()=>{(0,p.u4)(p.qY.SEE_ALL_EPISODES_CLICKED,{section_id:s.id,source:Y}),r?window.open(l,"_blank","noopener,noreferrer"):window.location.href=l},children:[(0,o.Y)("span",{children:P("See all episodes")}),(0,o.Y)(u.A,{size:14})]})})]})]})},Y=e=>{let{label:t,openInNewTab:n,podcastSettings:r,section:a,sectionUrl:s,trackingSource:l}=e,{iString:c}=(0,m.GO)(),_=(0,h.iF)({radius:"md"});return(0,o.FD)(b.I1,{className:"containerVertical-L_u6LQ",border:"detail-themed",padding:20,radius:"md",gap:20,children:[(0,o.Y)(b.Ye,{justifyContent:"center",children:r.artUrl&&(0,o.Y)(d.o,{className:i()(_,"logoVertical-p9LsNy"),src:(0,f.dJ9)(r.artUrl,440),maxWidth:164,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,o.FD)(b.I1,{gap:12,children:[(0,o.FD)(b.I1,{gap:8,children:[(0,o.Y)(g.EY.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",href:s,rel:"noopener noreferrer",target:"_blank",weight:"bold",children:r.title}),t&&(0,o.Y)(b.Ye,{children:(0,o.Y)(w,{label:t})}),(0,o.Y)(g.EY.B3,{color:"pub-secondary-text",font:"text",children:r.description})]}),(0,o.Y)("div",{children:(0,o.FD)(g.EY,{display:"inline-flex",alignItems:"center",gap:8,color:"accent",font:"text",size:14,weight:"medium",onClick:()=>{(0,p.u4)(p.qY.SEE_ALL_EPISODES_CLICKED,{section_id:a.id,source:l}),n?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s},children:[(0,o.Y)("span",{children:c("See all episodes")}),(0,o.Y)(u.A,{size:14})]})})]})]})},w=e=>{let{label:t}=e;return(0,o.Y)(b.Ye,{bg:"secondary",display:"inline-block",paddingX:6,radius:"sm",children:(0,o.Y)(g.EY,{color:"pub-secondary-text",font:"text",size:12,weight:"semibold",lineHeight:20,children:"member-only"===t?"+ Member-only":"free-with-ads"===t?"Free with ads":"Free"})})};var C=n(20562),P=n(12592),I=n(56458),D=n(4016),A=n(46009),S=n(39318),x=n(41086);let F=n(57324).VU.podcastsPage,N=e=>{let{idToMagicLink:t,pub:n,user:r}=e,{isMobile:a}=(0,_.sM)(),l=c()((0,I.th)(n),e=>{var t;return null!=(t=s()(n.navigationBarItems,t=>t.section_id===e.id))?t:999}),u=!!(null==r?void 0:r.is_subscribed),d=!u&&!a,m=l.filter(e=>u||!(0,D.dm)({sectionId:e.id})),p=u?[]:l.filter(e=>(0,D.dm)({sectionId:e.id})),h=null==t?void 0:t[n.id];return h||(h=(0,S.wpu)(n,{section:null,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!r||!r.is_free_subscribed,params:{utm_source:F}})),(0,o.Y)(P.c,{columns:d?3:2,paddingTop:a?8:void 0,children:(0,o.FD)(b.pT,{className:i()({"twoColumnGrid-pq1MC7":d}),direction:d?"row":"column",gap:d?void 0:40,children:[!u&&(0,o.FD)(b.I1,{alignItems:a?"stretch":"start",className:"sideColumn-FFh4jo",gap:24,paddingLeft:d?32:void 0,children:[(0,o.FD)(b.I1,{gap:a?12:16,children:[(0,o.Y)(g.EY.H2,{color:"pub-primary-text",font:"pub-headings",children:"Member-only Shows"}),(0,o.Y)(C.t,{firehoseFeedUrl:h,pub:n,trackingSource:F,variant:"member-only"})]}),(0,o.Y)(b.I1,{gap:a?16:24,children:p.map((e,i)=>{let s=(0,A.lL)({pub:n,section:e}),l=(null==t?void 0:t[e.id])||(0,S.wpu)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!r||!r.is_free_subscribed,params:{utm_source:F}}),c=(0,f.Dor)(n,{section:e,addBase:!0}),d=(0,D.rD)({sectionId:e.id})?"member-only":"free";return(0,o.FD)(o.FK,{children:[(0,o.Y)(a?v:Y,{label:d,openInNewTab:!0,podcastSettings:s,section:e,sectionUrl:c,setupUrl:u?l:null,trackingSource:F,user:null!=r?r:null}),i!==p.length-1&&a&&(0,o.Y)(b.Ye,{borderBottom:"detail-themed"})]})})})]}),(0,o.FD)(b.I1,{className:"mainColumn-cft5kf",gap:24,paddingRight:d?32:void 0,children:[(0,o.FD)(b.I1,{gap:a?12:16,children:[(0,o.FD)(g.EY.H2,{color:"pub-primary-text",font:"pub-headings",children:[n.name," Shows"]}),u&&(0,o.Y)(C.t,{pub:n,firehoseFeedUrl:h,trackingSource:F})]}),(0,o.Y)(b.I1,{gap:a?16:24,children:m.map((e,i)=>{let a=(0,A.lL)({pub:n,section:e}),s=(null==t?void 0:t[e.id])||(0,S.wpu)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!r||!r.is_free_subscribed,params:{utm_source:F}}),l=(0,f.Dor)(n,{section:e,addBase:!0}),c=(0,D.rD)({sectionId:e.id})?u?"member-only":"free-with-ads":"free";return(0,o.FD)(o.FK,{children:[(0,o.Y)(v,{label:c,openInNewTab:!0,podcastSettings:a,section:e,sectionUrl:l,setupUrl:u?s:null,subscribeUrl:(0,S.eV6)(n,{utm_source:F,simple:!0,next:document.location.href,referring_pub_ids:(0,x.y)("referring_pub_ids"),addBase:!0}),trackingSource:F,user:null!=r?r:null}),i!==m.length-1&&(0,o.Y)(b.Ye,{borderBottom:"detail-themed"})]})})})]})]})})}},72216:function(e,t,n){n.d(t,{E:()=>d,p:()=>p});var o=n(4006),r=n(84605),i=n(35369),a=n(33727),s=n(76977),l=n(81203),c=n(63136),u=n(39318);let d=(e,t)=>{var n;return{logoUrl:e.podcast_art_url||e.logo_url||(0,u.yX_)(),mainClickUrl:(0,u.t6y)({pub:e,section:null,addBase:!0}),buttonClickUrl:t,name:e.podcast_title||e.name,description:null!=(n=e.podcast_description||e.hero_text)?n:void 0}},m=e=>{let{logoUrl:t,mainClickUrl:n,buttonClickUrl:u,name:d,description:m,showButton:p}=e,{iString:_}=(0,r.GO)();return(0,o.FD)(a.Z,{gap:12,direction:"row",alignItems:"center",padding:12,children:[t&&(0,o.Y)(l.Nq,{size:48,logoUrl:t}),(0,o.FD)(s.VP,{gap:2,flex:"grow",children:[(0,o.Y)(c.EY.B3,{weight:"semibold",children:(0,o.Y)(c.Yq,{href:n,children:d})}),(0,o.Y)(c.EY.B4,{color:"secondary",children:m})]}),p&&(0,o.Y)(i.$n,{priority:"primary",href:u,newTab:!0,children:_("Set up")})]})},p=e=>{let{showButton:t,items:n}=e;return(0,o.Y)(s.VP,{gap:12,children:n.map(e=>(0,o.Y)(m,{logoUrl:e.logoUrl,mainClickUrl:e.mainClickUrl,buttonClickUrl:e.buttonClickUrl,name:e.name,description:e.description,showButton:t}))})}},47787:function(e,t,n){n(4006),n(17402),n(38804)},38804:function(e,t,n){n(17402),n(71783)},99156:function(e,t,n){n.d(t,{T:()=>s}),n(4006);var o=n(63950),r=n.n(o),i=n(17402);n(38804),n(32485),n(65670),n(71783);let a=(0,i.createContext)({hasReceivedInitialPreviewUIState:!1,isMobileEditor:!1,isPreviewMode:!1,activatePreviewBlock:r(),deactivatePreviewBlock:r(),requestBlockPicker:r(),requestModulePicker:r(),sendPreviewBlockUpdate:r(),sendSidebarModuleRemove:r(),sendThemePropertyDragEnd:r()}),s=()=>(0,i.useContext)(a)},57934:function(e,t,n){n.d(t,{S:()=>w,X:()=>C});var o=n(4006),r=n(32485),i=n.n(r),a=n(49436),s=n(17402),l=n(84605),c=n(97640),u=n(86500),d=n(12501),m=n(89490),p=n(35369),_=n(76977),h=n(37598),y=n(66511),b=n(11710),g=n(91324),f=n(21398),v=n(15663),Y=n(61060);function w(e){var t,r;let{canShowAlerts:i=!1}=e,{iString:_}=(0,l.GO)(),Y=(0,c.Vd)(),[w,P]=(0,s.useState)(!1),I=(0,d.st)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1}),D=(0,d.st)({pathname:"/api/v1/live_streams",query:{status:"scheduled",stream_type:"all"},auto:!1}),A=null!=(r=null==(t=D.result)?void 0:t.liveStreams)?r:[];(0,s.useEffect)(()=>{Y.activityUnreadCount>0&&(0,u.u4)(u.qY.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:Y.activityUnreadCount})},[Y.activityUnreadCount]);let S=()=>Promise.all([n.e("39966"),n.e("33393"),n.e("76439")]).then(n.bind(n,47737)),x=Y.activityUnreadCount;return(0,o.FD)(g.u,{trackingProps:{surface:"dropdown"},children:[(0,o.Y)(y.m_,{text:_("Activity"),side:"bottom",children:(0,o.Y)(h.A,{trigger:(0,o.FD)(p.K0,{"aria-label":"View activity",priority:"tertiary",onMouseEnter:S,position:"relative",children:[(0,o.Y)(a.A,{"aria-hidden":!0,size:20}),x>0&&(0,o.Y)(C,{count:x})]}),onOpen:()=>{I.refetch(),D.refetch()},children:(0,o.Y)(f.Ic,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:S,resource:I,bellCount:x,scheduledLiveStreams:A,onOpenScheduledModal:()=>P(!0),whileLoading:(0,o.Y)(m.az,{width:400})})})}),(0,o.Y)(b._,{isOpen:w,onClose:()=>P(!1),scheduledLiveStreams:A,onCancelStream:()=>D.refetch()}),i&&(0,o.Y)(v.r,{})]})}function C(e){let{count:t}=e;return(0,o.Y)(_.pT,{className:i()(Y.A.badge,t<10&&Y.A.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},38691:function(e,t,n){n.d(t,{a:()=>_});var o=n(4006),r=n(54687),i=n(17402),a=n(84605),s=n(86500),l=n(17028),c=n(37598),u=n(66511),d=n(70486),m=n(21398),p=n(57934);function _(){var e,t;let{iString:n}=(0,a.GO)(),_=null!=(t=null==(e=(0,d.a8)().data)?void 0:e.unreadCount)?t:0;return(0,i.useEffect)(()=>{(0,s.u4)(s.qY.CHAT_DROPDOWN_BADGE_SHOWN,{count:_})},[_]),(0,o.Y)(u.m_,{text:n("Chat"),side:"bottom",children:(0,o.Y)(c.A,{trigger:(0,o.FD)(l.K0,{"aria-label":"View chats",priority:"tertiary",onMouseEnter:h,position:"relative",children:[(0,o.Y)(r.A,{size:20}),_>0&&(0,o.Y)(p.X,{count:_})]}),onClose:()=>{(0,s.u4)(s.qY.CHAT_DROPDOWN_CLOSED)},children:(0,o.Y)(m.Ic,{module:"./MiniInbox",onRequest:h,resolve:e=>e.MiniChatInbox,whileLoading:(0,o.Y)(l.az,{width:360})})})})}let h=()=>Promise.all([n.e("94219"),n.e("83034"),n.e("26973"),n.e("30474"),n.e("78176"),n.e("20711"),n.e("1116"),n.e("24144"),n.e("69280")]).then(n.bind(n,62845))},36319:function(e,t,n){n.d(t,{k_:()=>F});var o=n(69277),r=n(70408),i=n(4006),a=n(83673),s=n.n(a),l=n(63375),c=n.n(l),u=n(50014),d=n.n(u),m=n(17402),p=n(25250),_=n(46271),h=n(96467),y=n(94729),b=n(44333),g=n(68349),f=n(15144),v=n(30042),Y=n(70486),w=n(62488),C=n(26606),P=n(69911),I=n(26095),D=n(11510),A=n(43296),S=n(16291),x=n(38704);function F(e){let{children:t,surface:n}=e,{user:a,userSettings:s}=(0,_.ur)(),l=s.newest_seen_chat_item_published_at,{path:c}=(0,b.zy)(),u=(0,D.Iu)(),d=(0,A.XW)(),p=(0,A.$P)(),[y,g]=(0,h.K)(M,(0,r._)((0,o._)({},Y.v$),{user:a,users:new Map(a?[[a.id,a]]:[])}));(0,Y.a8)({auto:!!a});let v=(0,m.useRef)(0);return(0,m.useEffect)(()=>{if(d&&a)return d.listen({["user:".concat(a.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?g(X(e)):"chat:updated-post"===e.type?g(ee(e)):"chat:new-post"===e.type&&g(et(e))}}})},[d]),(0,m.useEffect)(()=>{"open"===p&&a&&g((0,f.D1)())},[p]),(0,m.useEffect)(()=>{if("open"!==p){let e,t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;a&&e-v.current>5e3&&"hidden"!==t&&(v.current=e,g((0,f.D1)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2*Math.random()*1e3))},o=(0,I.x)(t);return c.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),o()}}},[l,c,u,g,p]),(0,i.Y)(w.t.Provider,{value:n,children:(0,i.Y)(Y.qe.Provider,{value:g,children:(0,i.Y)(Y.Vn.Provider,{value:y,children:t})})})}let N={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},E={isLoading:!1,hasMore:!1,error:null},k={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},T={before:E,after:(0,r._)((0,o._)({},E),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function M(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"!==t.type)return e;{var n;let i=t.payload,a=null!=(n=e.chats.get(i.id))?n:N;return(0,r._)((0,o._)({},e),{chats:(0,x.Jb)(e.chats,i.id,(0,r._)((0,o._)({},a),{publication:i})),publications:(0,x.Jb)(e.publications,i.id,i)})}}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:i,directMessagesUnreadCount:a,pendingInviteCount:l,pendingInviteUnreadCount:c,mostRecentChatTimestamp:u}=t.payload,d=(0,r._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...s()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,userStatus:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...s()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:i}=t,{id:a}=i;return[i.id,(0,r._)((0,o._)({},e.communityComments.get(a)),{comment:i,userId:i.user_id,quoteId:null!=(n=i.quote_id)?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...s()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let i=null!=(n=e.chats.get(t.publication.id))?n:N;return[t.publication.id,(0,r._)((0,o._)({},i),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...s()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,r._)((0,o._)({},k,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var i,a,s,l,c,u,d,m;return"chat"===t.type?(0,r._)((0,o._)({},t),{communityPostId:null!=(u=null==(i=t.communityPost)?void 0:i.id)?u:null,muteStatus:null!=(d=t.muteStatus)?d:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null==(s=e.user)||null==(a=s.primary_publication)?void 0:a.id)||(null==(l=e.inbox.threads.get(t.id))?void 0:l.isPrimary)}):(0,r._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!=(m=null==(c=t.recentMessage)?void 0:c.id)?m:null,isPrimary:!1})}),p=$(m),_=(0,x.ZZ)(e.inbox.threads,m,e=>e.id),h=$([..._.values()]),{filter:y}=e.inbox,b=(0,v.p)(y);return O((0,r._)((0,o._)({},d),{inbox:(0,r._)((0,o._)({},e.inbox),{resources:(0,r._)((0,o._)({},e.inbox.resources),{[b]:{hasMore:i&&p===h,isLoading:!1}}),threads:_,directMessagesUnreadCount:a,pendingInviteCount:l,pendingInviteUnreadCount:c,mostRecentChatTimestamp:u})}))}case"inbox-pin":{let{itemId:n,isPinned:i}=t.payload;return O((0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.uu)(e.inbox.threads,n,{isPinned:i})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.uu)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:i,pendingInviteUnreadCount:a,pubChatUnreadCount:s}=t.payload;return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:i,pendingInviteUnreadCount:a,pubChatUnreadCount:s})})}case"inbox-new_error":return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{resources:(0,r._)((0,o._)({},e.inbox.resources),{[(0,v.p)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:i}=t.payload;return O((0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.QA)(e.inbox.threads,K(i),e=>(0,r._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return O((0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.QA)(e.inbox.threads,K(n),e=>(0,r._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,i=K(n.id);return(0,r._)((0,o._)({},e),{chats:(0,x.QT)(e.chats,n.id),inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.QT)(e.inbox.threads,K(n.id)),threadList:e.inbox.threadList.filter(e=>e!==i)})})}case"pub_chat-join":{let n=t.payload;K(n.id);let i=(0,x.Jb)(e.inbox.threads,K(n.id),{id:K(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},O((0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:i}),chats:(0,x.QA)(e.chats,n.id,e=>(0,r._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,x.Jb)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,i;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,i=e.conversations.get(n);if(i&&i.replyIds.length>0)return e;return(0,r._)((0,o._)({},e),{conversations:(0,x.Jb)(e.conversations,n,(0,o._)({},i,k))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let i=G(n);return(0,r._)((0,o._)({},e),{conversations:(0,x.QT)(e.conversations,n),inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.QT)(e.inbox.threads,i),threadList:e.inbox.threadList.filter(e=>e!==i)})})}case"conversation-request_error":{let{conversationId:n,cursor:i,edge:a,error:s}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[a].cursor!==i)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,r._)((0,o._)({},e),{conversations:(0,x.Jb)(e.conversations,n,(0,r._)((0,o._)({},l),{[a]:{isLoading:!1,cursor:i,error:s}}))})}case"conversation-load_more":{let{edge:i,cursor:a,page:{thread:l,replies:c,publications:u,comments:d,pastCursor:m,futureCursor:p,profile:_,subscriberContext:h}}=t.payload,y=c.map(e=>e.comment.id),b=new Set(y),g=e.conversations.get(l.id);if(!g)return console.error("Attempting to load messages for missing conversation"),e;if(g[i].cursor!==a)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let f=g.replyIds.filter(e=>!b.has(e));f="before"===i?y.concat(f):f.concat(y);let v=(0,r._)((0,o._)({},g,a?{[i]:{isLoading:!1,cursor:"before"===i?m:p,error:null}}:{before:{isLoading:!1,cursor:m,error:null},after:{isLoading:!1,cursor:p,error:null}}),{thread:l,replyIds:f}),Y=_&&(null==(n=l.members.find(e=>e.user_id===_.id))?void 0:n.user),w=(0,r._)((0,o._)({},e),{conversations:(0,x.Jb)(e.conversations,l.id,v),communityComments:H(e.communityComments,c.flatMap(e=>s()([e,e.quote]).map(W)),e=>e.comment.id,e=>e.comment.created_at),users:(0,x.ZZ)(e.users,c.flatMap(e=>{var t;return s()([e.user,null==(t=e.quote)?void 0:t.user])}),e=>e.id),profiles:_?(0,x.Jb)(e.profiles,_.id,(0,r._)((0,o._)({},Y,_),{subscriberContext:h})):e.profiles,publications:u?(0,x.ZZ)(e.publications,u,e=>e.id):e.publications,notes:d?(0,x.ZZ)(e.notes,d,e=>"c-".concat(e.id)):e.notes});if("after"===i||!a)return J(w,l.id,null);return w}case"conversation-comments-new":{let{conversationId:n,linkUrl:a,quoteReply:s}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let c={comment:(0,r._)((0,o._)({},q(e,t.payload)),{quote_id:null!=(i=l.quoteReply)?i:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:a?{url:a,host:(0,g.EW)(a)}:void 0,quote:s,quoteId:null==s?void 0:s.comment.id},u=(0,r._)((0,o._)({},l),{quoteReply:null,replyIds:[...l.replyIds,c.comment.id]});return J((0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,c.comment.id,c),conversations:(0,x.Jb)(e.conversations,n,u)}),n,c.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:i,reply:a,publications:s,comments:l}=t.payload;n=null!=n?n:a.client_id;let c=e.conversations.get(i);if(!c)throw Error("Attempted to post message to missing conversation");let u=n&&e.communityComments.get(n),d=new Map(e.communityComments),m=W(a);d.set(a.comment.id,u?(0,r._)((0,o._)({},m),{clientId:u.clientId,comment:(0,r._)((0,o._)({},m.comment),{media_uploads:u.comment.media_uploads})}):m),a.quote&&d.set(a.quote.comment.id,W(a.quote));let p=c.replyIds,_=a.comment.id;return n&&(p=p.map(e=>e===n?_:e)),p.includes(_)||(p=[...p,_]),p=[...new Set(p)],J((0,r._)((0,o._)({},e),{conversations:(0,x.Jb)(e.conversations,i,(0,r._)((0,o._)({},c),{replyIds:p})),communityComments:d,publications:s?(0,x.ZZ)(e.publications,s,e=>e.id):e.publications,notes:l?(0,x.ZZ)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),i,a.comment.id)}case"conversation-comments-error":{let{commentId:n,error:i}=t.payload,a=e.communityComments.get(n);if(!a)throw Error("Attempted to assing error to missing comment");if(!a.isNew)throw Error("Attempted to set error on persisted comment");return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{error:i}))})}case"conversation-quote-set":{let{conversationId:n,commentId:i}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Tried to quote a message in a conversation that does not exist");return(0,r._)((0,o._)({},e),{conversations:(0,x.Jb)(e.conversations,n,(0,r._)((0,o._)({},a),{quoteReply:i}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return R(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,r._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return R(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return R(e,n,{unmute_at:o?(0,S.A)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:i}=t.payload,a=e.communityComments.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=i!==a.comment.reaction;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{comment:U(a.comment,i,s)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,i,a,s,l,u;let{publication_id:d}=t.payload,m=null!=(n=e.chats.get(d))?n:N;switch(t.type){case"posts-request_initial":return(0,r._)((0,o._)({},e),{chats:(0,x.Jb)(e.chats,d,(0,r._)((0,o._)({},m),{after:(0,r._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,r._)((0,o._)({},e),{chats:(0,x.Jb)(e.chats,d,(0,r._)((0,o._)({},m),{before:(0,r._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:i}=t.payload,a=n.threads.find(e=>"deleted"!==e.communityPost.status),s=H(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=K(d),u=(null==m?void 0:m.isLoaded)?{[i]:{isLoading:!1,hasMore:"before"===i?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},p=(0,r._)((0,o._)({},e),{users:(0,x.ZZ)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:s,chats:(0,x.Jb)(e.chats,d,(0,r._)((0,o._)({},m,u),{posts:c()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return j(null==(n=s.get(e))?void 0:n.communityPost.created_at,null==(o=s.get(t))?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.QA)(e.inbox.threads,l,e=>{var t,i;return"chat"===e.type?(0,r._)((0,o._)({},e),{communityPostId:null!=(t=null==a?void 0:a.communityPost.id)?t:e.communityPostId,lastViewedAt:null!=(i=n.lastViewedAt)?i:null}):e})})});return(0,r._)((0,o._)({},p),{inbox:"before"===i?e.inbox:(0,r._)((0,o._)({},e.inbox),{threadList:V(p)})})}case"posts-error":{let{error:n,direction:i}=t.payload;return(0,r._)((0,o._)({},e),{chats:(0,x.Jb)(e.chats,d,(0,r._)((0,o._)({},m),{[i]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.uu)(e.inbox.threads,K(d),{lastViewedAt:new Date().toISOString()})}),chats:(0,x.Jb)(e.chats,d,(0,r._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),s={communityPost:(0,r._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!=(a=null==(i=e.user)?void 0:i.id)?a:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0,userStatus:null};return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,s.communityPost.id,s),chats:(0,x.Jb)(e.chats,d,(0,r._)((0,o._)({},m),{posts:[s.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:i}=t.payload;if(!m.posts.includes(n))return e;let a=new Map(e.communityPosts);return a.set(i.communityPost.id,i),(0,r._)((0,o._)({},e),{communityPosts:a})}case"posts-new_incoming":{let{chatItem:n,publication_id:i,id:a}=t.payload,s=new Map(e.communityPosts);s.set(a,n);let l=Array.from(new Set([a,...m.posts]));return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.uu)(e.inbox.threads,K(i),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,x.Jb)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:s,chats:(0,x.Jb)(e.chats,i,(0,r._)((0,o._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:i,publication_id:a}=t.payload,s=new Map(e.communityPosts);s.delete(n),s.set(i.communityPost.id,i);let l=m.posts.includes(n)?m.posts.map(e=>e===n?i.communityPost.id:e):m.after.hasMore?m.posts:[i.communityPost.id,...m.posts];return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.uu)(e.inbox.threads,K(a),{communityPostId:i.communityPost.id})}),communityPosts:s,chats:(0,x.Jb)(e.chats,a,(0,r._)((0,o._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:i}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a)||!(null==(s=a.communityPost)?void 0:s.reactions))return console.warn("chat item does not exist"),e;if(a.communityPost.reaction===i)return console.warn("already set this reaction",i),e;return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},a),{communityPost:U(a.communityPost,i,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:i}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a)||!(null==(l=a.communityPost)?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},a),{communityPost:U(a.communityPost,i,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:i}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{L(t,s);let n=e.replies.get(t);n&&n.comments.forEach(e=>{L(e,s)})});let c=null==(u=e.chats.get(i))?void 0:u.posts.filter(t=>{var o;if(t===n)return!1;let r=e.communityPosts.get(t);return(null==r||null==(o=r.communityPost)?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,r;let i=null==(o=e.communityPosts.get(t))?void 0:o.communityPost,a=null==(r=e.communityPosts.get(n))?void 0:r.communityPost;return j(null==i?void 0:i.created_at,null==a?void 0:a.created_at)})[0],d=(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},a),{communityPost:(0,r._)((0,o._)({},a.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:s,inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.QA)(e.inbox.threads,K(i),e=>"chat"===e.type?(0,r._)((0,o._)({},e),{communityPostId:null!=c?c:null}):e)})});return(0,r._)((0,o._)({},d),{inbox:(0,r._)((0,o._)({},d.inbox),{threadList:V(d)})})}case"posts-flag_post":{let{id:n}=t.payload,i=e.communityPosts.get(n);if(!i||!Z(i))return console.warn("chat item does not exist"),e;return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},i),{communityPost:(0,r._)((0,o._)({},i.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:i}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a))return console.warn("chat item does not exist"),e;return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},a),{communityPost:(0,r._)((0,o._)({},a.communityPost),{is_locked:i})}))})}case"posts-link_metadata":{let{id:n,link_metadata:i}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},a),{communityPost:(0,r._)((0,o._)({},a.communityPost),{link_metadata:i})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:i,scrollCache:a}=t.payload;return(0,r._)((0,o._)({},e),{chats:(0,x.Jb)(e.chats,n,(0,r._)((0,o._)({},m),{scrollOffset:i,scrollCache:a}))})}case"posts-update_post":{let{id:n,post:i}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a))return console.warn("post does not exist"),e;return(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,n,(0,r._)((0,o._)({},a),{communityPost:(0,o._)({},a.communityPost,i)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,r._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,i,a,l,u,d,m,p,_;let h,b=null,g=null;"parentCommentId"in(_=t).payload&&_.payload.parentCommentId?g=t.payload.parentCommentId:"postId"in t.payload&&(b=t.payload.postId);let f=e=>g?{replies:e}:{comments:e};h=g?null!=(n=e.replies.get(g))?n:T:b&&null!=(i=e.comments.get(b))?i:T;let v=g?e.replies:e.comments,Y=null!=g?g:b;switch(t.type){case"replies-clear":case"comments-clear":return Y?(0,o._)({},e,f((0,x.Jb)(v,Y,T))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:i}=t.payload,s=(0,r._)((0,o._)({},E),{isLoading:!0,hasMore:!1}),l=i&&(null==h?void 0:h.comments.includes(i.id));return(0,o._)({},e,f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{before:"desc"===n?s:E,after:"asc"===n?s:E,order:n,target:null!=i?i:null,isLoaded:(!i||!!l)&&null!=(a=null==h?void 0:h.isLoaded)&&a}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{[n]:(0,r._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:i,parent:a,replies:l,more:u,moreAfter:d,moreBefore:m,lastViewedAt:p}}=t.payload,_=null;if((null==i?void 0:i.communityPost.publication_id)&&(null==i?void 0:i.communityPost.muted)){let t={is_muted:!0,type:i.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==i?void 0:i.communityPost.publication_id)||N;n.muteStatus||(_=(0,x.Jb)(e.chats,i.communityPost.publication_id,(0,r._)((0,o._)({},n),{muteStatus:t})))}let y=l.map(e=>e.comment.id),b=H(e.communityComments,l.flatMap(e=>s()([e,e.quote]).map(W)),e=>e.comment.id,e=>e.comment.updated_at);a&&b.set(a.comment.id,(0,r._)((0,o._)({},a),{userId:a.user.id}));let g=(0,x.ZZ)(e.users,s()([null==i?void 0:i.communityPost.user,null==a?void 0:a.user]),e=>e.id),w=Y?v.get(Y):null,C=(null==w?void 0:w.isLoaded)?{[n]:{isLoading:!1,hasMore:u,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:d,error:null}};return(0,o._)((0,r._)((0,o._)((0,r._)((0,o._)({},e),{communityPosts:i?(0,x.Jb)(e.communityPosts,i.communityPost.id,i):e.communityPosts,communityComments:b}),_?{chats:_}:{}),{users:new Map([...g,...l.map(e=>[e.user.id,e.user])])}),f((0,x.Jb)(v,Y,(0,r._)((0,o._)((0,r._)((0,o._)({},h),{comments:c()([...h.comments,...y]).sort((e,t)=>{var n,o;return j(null==(n=b.get(e))?void 0:n.comment.created_at,null==(o=b.get(t))?void 0:o.comment.created_at)}).filter(e=>{var t;return(null==(t=b.get(e))?void 0:t.comment.status)!=="flagged"})}),C),{order:"after"!==n||u?h.order:"desc",isLoaded:!0,lastViewedAt:p}))))}case"replies-target":case"comments-target":return Y?(0,o._)({},e,f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:i}=t.payload;e=(0,r._)((0,o._)({},e),{communityPosts:(0,x.QA)(e.communityPosts,i,e=>(0,r._)((0,o._)({},e),{communityPost:(0,r._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:i}=t.payload;e=(0,r._)((0,o._)({},e),{communityComments:(0,x.QA)(e.communityComments,i,e=>(0,r._)((0,o._)({},e),{comment:(0,r._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return Y?(0,o._)({},e,f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return Y?(0,o._)({},e,f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,i={comment:(0,r._)((0,o._)({},q(e,n)),{quote_id:null!=(d=null==(l=n.quoteReply)?void 0:l.comment.id)?d:null,post_id:n.postId,parent_id:g}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null==(u=n.quoteReply)?void 0:u.comment.id,pub_roles:n.pubRoles},a=(0,o._)((0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,i.comment.id,i)}),f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{comments:[i.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(g){let n=e.communityComments.get(g);if(n&&Q(n)){let i=B(n.comment,e.user,t.payload.postId);a.communityComments.set(g,(0,r._)((0,o._)({},n),{comment:i}))}}let s=e.communityPosts.get(t.payload.postId);if(s&&Z(s)){let n=B(s.communityPost,e.user,t.payload.postId);a.communityPosts=(0,x.Jb)(e.communityPosts,t.payload.postId,(0,r._)((0,o._)({},s),{communityPost:n}))}return a}case"replies-commit":case"comments-commit":{let{id:n,reply:i}=t.payload,a=new Map(e.communityComments);a.delete(n),a.set(i.comment.id,W(i));let s=h.comments.includes(n)?h.comments.map(e=>e===n?i.comment.id:e):h.after.hasMore?h.comments:[i.comment.id,...h.comments];return(0,o._)((0,r._)((0,o._)({},e),{communityComments:a}),f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{comments:s}))))}case"comments-updated":{let{id:n,reply:i}=t.payload;if(!h.comments.includes(n))return e;let a=h.comments.map(e=>e===n?i.comment.id:e);return(0,o._)((0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,W(i))}),f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{comments:a}))))}case"comments-new_incoming":{let{id:n,reply:i}=t.payload;return(0,o._)((0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,W(i)),users:i.user?(0,x.Jb)(e.users,i.userId,i.user):e.users}),f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{comments:Array.from(new Set([i.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:i}=t.payload;if(i instanceof y.fk){let t=i.body.post;t&&(e=(0,r._)((0,o._)({},e),{communityPosts:(0,x.Jb)(e.communityPosts,t.communityPost.id,(0,r._)((0,o._)({},t),{pubRole:null,userStatus:null})),users:t.user?(0,x.Jb)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,f((0,x.Jb)(v,Y,(0,r._)((0,o._)({},h),{[n]:(0,r._)((0,o._)({},h[n]),{error:i})}))))}case"comments-new_reaction":{let{id:n,reaction:i}=t.payload,a=e.communityComments.get(n);if(!a||!Q(a)||!(null==(m=a.comment)?void 0:m.reactions))return console.warn("comment does not exist"),e;if(a.comment.reaction===i)return console.warn("reaction already set"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{comment:U(a.comment,i,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:i}=t.payload,a=e.communityComments.get(n);if(!a||!Q(a)||!(null==(p=a.comment)?void 0:p.reactions))return console.warn("comment does not exist"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{comment:U(a.comment,i,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,i=e.communityComments.get(n);if(!i)return console.warn("comment does not exist, cannot delete"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},i),{comment:(0,r._)((0,o._)({},i.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:i}=t.payload,a=e.communityComments.get(n);if(!a||!Q(a))return console.warn("comment does not exist"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{comment:(0,o._)({},a.comment,i)}))})}case"comments-flag_comment":{let{id:n}=t.payload,i=e.communityComments.get(n);if(!i||!Q(i))return console.warn("comment does not exist"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},i),{comment:(0,r._)((0,o._)({},i.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:i}=t.payload,a=e.communityComments.get(n);if(!a||!Q(a))return console.warn("comment does not exist"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{is_banned:i}))})}case"comments-lock_replies":{let{id:n,isLocked:i}=t.payload,a=e.communityComments.get(n);if(!a||!Q(a))return console.warn("comment does not exist"),e;if(a.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,r._)((0,o._)({},e),{communityComments:(0,x.Jb)(e.communityComments,n,(0,r._)((0,o._)({},a),{comment:(0,r._)((0,o._)({},a.comment),{is_locked:i})}))})}default:throw Error("Invalid type")}}(e,t):e}function B(e,t,n){var i,a;let s;return(t&&t.photo_url&&(s=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(s=d()([...s,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,r._)((0,o._)({},e),{recent_commenters:s,reply_count:1+(null!=(i=e.reply_count)?i:0)}):"comment_count"in e?(0,r._)((0,o._)({},e),{recent_commenters:s,comment_count:1+(null!=(a=e.comment_count)?a:0)}):e}function L(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,r._)((0,o._)({},n),{comment:(0,r._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function q(e,t){var n,i,a;let s;return(0,r._)((0,o._)({},{id:"",created_at:s=new Date().toISOString(),updated_at:s,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!=(i=t.mediaUploads)?i:null,user_id:null!=(a=null==(n=e.user)?void 0:n.id)?a:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function J(e,t,n){let i=G(t),a=e.inbox.threads.get(i),s=(null==a?void 0:a.type)==="direct-message"?a:null,l=(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threads:(0,x.Jb)(e.inbox.threads,i,(0,r._)((0,o._)({timestamp:new Date().toISOString()},s),{id:i,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,r._)((0,o._)({},l),{inbox:(0,r._)((0,o._)({},e.inbox),{threadList:V(l)})})}function U(e,t,n){var i,a;let s=e.reaction,l=(0,o._)({},e.reactions);return l[t]=(null!=(i=l[t])?i:0)+(n?1:-1),n&&s&&(l[s]=(null!=(a=l[s])?a:0)-1),(0,r._)((0,o._)({},e),{reactions:l,reaction:n?t:null})}function O(e){return(0,r._)((0,o._)({},e),{inbox:(0,r._)((0,o._)({},e.inbox),{threadList:V(e)})})}function V(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:j(z(e,t),z(e,n))).map(e=>e.id)}function z(e,t){var n,o,r,i;return"chat"===t.type?null!=(r=t.communityPostId&&(null==(o=e.communityPosts.get(t.communityPostId))?void 0:o.communityPost.created_at))?r:t.timestamp:null!=(i=null==(n=(0,P.H)(e,t))?void 0:n.comment.created_at)?i:t.timestamp}function R(e,t,n){let i=e.conversations.get(t),a=null==i?void 0:i.thread;if(!i||!a)throw Error("Tried to update a conversation that does not exist.");let s=e.user;if(!s)throw Error("Cannot update conversation if the user does not exist.");return(0,r._)((0,o._)({},e),{conversations:(0,x.Jb)(e.conversations,t,(0,r._)((0,o._)({},i),{thread:(0,r._)((0,o._)({},a),{members:a.members.map(e=>e.user_id===s.id?(0,o._)({},e,n):e)})}))})}function K(e){return"chat-".concat(e)}function G(e){return"direct-message-".concat(e)}function W(e){var t,n,i,a;return(0,r._)((0,o._)({},e),{userId:null==(t=e.user)?void 0:t.id,quoteId:null!=(a=null!=(i=null==(n=e.quote)?void 0:n.comment.id)?i:e.comment.quote_id)?a:void 0})}function Z(e){return!0!==e.isNew}function Q(e){return!0!==e.isNew}function j(e,t){return e===t?0:!t||e&&e>t?-1:1}function H(e,t,n,r){let i=new Map(e);for(let e of t){let t=n(e),a=i.get(t);if(!a){i.set(t,e);continue}r(e)>=r(a)&&i.set(t,(0,o._)({},a,e))}return i}function $(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let r=null!=(o=n.timestamp)?o:t;return r<e?r:e},t)}let X=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,C.i)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,p.Tk)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,i;let{post:a}=e;t("deleted"===a.status?{type:"posts-delete_post",payload:{id:a.id,publication_id:a.publication_id}}:{type:"posts-updated",payload:{id:a.id,chatItem:{communityPost:(0,r._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null==(n=a.user_pub_role_object)?void 0:n.role}),pubRole:null!=(i=a.user_pub_role_object)?i:null,userStatus:null}}})},et=e=>async t=>{var n,i;let{post:a}=e;t({type:"posts-new_incoming",payload:{publication_id:a.publication_id,id:a.id,chatItem:{communityPost:(0,r._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null==(n=a.user_pub_role_object)?void 0:n.role}),pubRole:null!=(i=a.user_pub_role_object)?i:null,userStatus:null}}})}},29611:function(e,t,n){n.d(t,{v:()=>a});var o=n(4006),r=n(94729),i=n(36372);function a(){let e=(0,i.d)();return(t,n)=>{e.popToast(()=>(0,o.Y)(i.y,{text:(0,r.Qd)(t,n)}))}}},93699:function(e,t,n){n(92636)}}]);