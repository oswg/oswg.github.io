!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};t.SENTRY_RELEASE={id:"substack@af5f699"};var e=(new t.Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="90a6ebed-9c2d-460c-8e7a-512af8b6c41e",t._sentryDebugIdIdentifier="sentry-dbid-90a6ebed-9c2d-460c-8e7a-512af8b6c41e")}catch(t){}}();"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["23897"],{43627:function(t,e,r){r.d(e,{JR:()=>k,be:()=>s,gB:()=>c,gl:()=>w,kL:()=>a});var n=r(17402),i=r(15871),o=r(74979);function s(t,e,r){let n=t.slice();return n.splice(r<0?n.length+r:r,0,n.splice(e,1)[0]),n}function l(t){return null!==t&&t>=0}let a=t=>{let{rects:e,activeIndex:r,overIndex:n,index:i}=t,o=s(e,n,r),l=e[i],a=o[i];return a&&l?{x:a.left-l.left,y:a.top-l.top,scaleX:a.width/l.width,scaleY:a.height/l.height}:null},p="Sortable",h=n.default.createContext({activeIndex:-1,containerId:p,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:a,disabled:{draggable:!1,droppable:!1}});function c(t){let{children:e,id:r,items:s,strategy:l=a,disabled:c=!1}=t,{active:u,dragOverlay:f,droppableRects:d,over:m,measureDroppableContainers:g}=(0,i.fF)(),y=(0,o.YG)(p,r),w=null!==f.rect,v=(0,n.useMemo)(()=>s.map(t=>"object"==typeof t&&"id"in t?t.id:t),[s]),b=null!=u,k=u?v.indexOf(u.id):-1,S=m?v.indexOf(m.id):-1,x=(0,n.useRef)(v),M=!function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}(v,x.current),R=-1!==S&&-1===k||M,C="boolean"==typeof c?{draggable:c,droppable:c}:c;(0,o.Es)(()=>{M&&b&&g(v)},[M,v,b,g]),(0,n.useEffect)(()=>{x.current=v},[v]);let I=(0,n.useMemo)(()=>({activeIndex:k,containerId:y,disabled:C,disableTransforms:R,items:v,overIndex:S,useDragOverlay:w,sortedRects:v.reduce((t,e,r)=>{let n=d.get(e);return n&&(t[r]=n),t},Array(v.length)),strategy:l}),[k,y,C.draggable,C.droppable,R,v,S,d,w,l]);return n.default.createElement(h.Provider,{value:I},e)}let u=t=>{let{id:e,items:r,activeIndex:n,overIndex:i}=t;return s(r,n,i).indexOf(e)},f=t=>{let{containerId:e,isSorting:r,wasDragging:n,index:i,items:o,newIndex:s,previousItems:l,previousContainerId:a,transition:p}=t;return!!p&&!!n&&(l===o||i!==s)&&(!!r||s!==i&&e===a)},d={duration:200,easing:"ease"},m="transform",g=o.Ks.Transition.toString({property:m,duration:0,easing:"linear"}),y={roleDescription:"sortable"};function w(t){var e,r,s,a;let{animateLayoutChanges:p=f,attributes:c,disabled:w,data:v,getNewIndex:b=u,id:k,strategy:S,resizeObserverConfig:x,transition:M=d}=t,{items:R,containerId:C,activeIndex:I,disabled:J,disableTransforms:N,sortedRects:T,overIndex:E,useDragOverlay:F,strategy:O}=(0,n.useContext)(h),A=(e=w,r=J,"boolean"==typeof e?{draggable:e,droppable:!1}:{draggable:null!=(s=null==e?void 0:e.draggable)?s:r.draggable,droppable:null!=(a=null==e?void 0:e.droppable)?a:r.droppable}),z=R.indexOf(k),_=(0,n.useMemo)(()=>({sortable:{containerId:C,index:z,items:R},...v}),[C,v,z,R]),K=(0,n.useMemo)(()=>R.slice(R.indexOf(k)),[R,k]),{rect:D,node:L,isOver:j,setNodeRef:$}=(0,i.zM)({id:k,data:_,disabled:A.droppable,resizeObserverConfig:{updateMeasurementsFor:K,...x}}),{active:B,activatorEvent:W,activeNodeRect:Y,attributes:X,setNodeRef:q,listeners:G,isDragging:U,over:P,setActivatorNodeRef:V,transform:Z}=(0,i.PM)({id:k,data:_,attributes:{...y,...c},disabled:A.draggable}),H=(0,o.jn)($,q),Q=!!B,tt=Q&&!N&&l(I)&&l(E),te=!F&&U,tr=te&&tt?Z:null,tn=tt?null!=tr?tr:(null!=S?S:O)({rects:T,activeNodeRect:Y,activeIndex:I,overIndex:E,index:z}):null,ti=l(I)&&l(E)?b({id:k,items:R,activeIndex:I,overIndex:E}):z,to=null==B?void 0:B.id,ts=(0,n.useRef)({activeId:to,items:R,newIndex:ti,containerId:C}),tl=R!==ts.current.items,ta=p({active:B,containerId:C,isDragging:U,isSorting:Q,id:k,index:z,items:R,newIndex:ts.current.newIndex,previousItems:ts.current.items,previousContainerId:ts.current.containerId,transition:M,wasDragging:null!=ts.current.activeId}),tp=function(t){let{disabled:e,index:r,node:s,rect:l}=t,[a,p]=(0,n.useState)(null),h=(0,n.useRef)(r);return(0,o.Es)(()=>{if(!e&&r!==h.current&&s.current){let t=l.current;if(t){let e=(0,i.Sj)(s.current,{ignoreTransform:!0}),r={x:t.left-e.left,y:t.top-e.top,scaleX:t.width/e.width,scaleY:t.height/e.height};(r.x||r.y)&&p(r)}}r!==h.current&&(h.current=r)},[e,r,s,l]),(0,n.useEffect)(()=>{a&&p(null)},[a]),a}({disabled:!ta,index:z,node:L,rect:D});return(0,n.useEffect)(()=>{Q&&ts.current.newIndex!==ti&&(ts.current.newIndex=ti),C!==ts.current.containerId&&(ts.current.containerId=C),R!==ts.current.items&&(ts.current.items=R)},[Q,ti,C,R]),(0,n.useEffect)(()=>{if(to===ts.current.activeId)return;if(to&&!ts.current.activeId){ts.current.activeId=to;return}let t=setTimeout(()=>{ts.current.activeId=to},50);return()=>clearTimeout(t)},[to]),{active:B,activeIndex:I,attributes:X,data:_,rect:D,index:z,newIndex:ti,items:R,isOver:j,isSorting:Q,isDragging:U,listeners:G,node:L,overIndex:E,over:P,setNodeRef:H,setActivatorNodeRef:V,setDroppableNodeRef:$,setDraggableNodeRef:q,transform:null!=tp?tp:tn,transition:tp||tl&&ts.current.newIndex===z?g:(!te||(0,o.kx)(W))&&M&&(Q||ta)?o.Ks.Transition.toString({...M,property:m}):void 0}}function v(t){if(!t)return!1;let e=t.data.current;return!!e&&"sortable"in e&&"object"==typeof e.sortable&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable}let b=[i.vL.Down,i.vL.Right,i.vL.Up,i.vL.Left],k=(t,e)=>{let{context:{active:r,collisionRect:n,droppableRects:s,droppableContainers:l,over:a,scrollableAncestors:p}}=e;if(b.includes(t.code)){if(t.preventDefault(),!r||!n)return;let e=[];l.getEnabled().forEach(r=>{if(!r||null!=r&&r.disabled)return;let o=s.get(r.id);if(o)switch(t.code){case i.vL.Down:n.top<o.top&&e.push(r);break;case i.vL.Up:n.top>o.top&&e.push(r);break;case i.vL.Left:n.left>o.left&&e.push(r);break;case i.vL.Right:n.left<o.left&&e.push(r)}});let u=(0,i.y$)({active:r,collisionRect:n,droppableRects:s,droppableContainers:e,pointerCoordinates:null}),f=(0,i.Vy)(u,"id");if(f===(null==a?void 0:a.id)&&u.length>1&&(f=u[1].id),null!=f){let t=l.get(r.id),e=l.get(f),a=e?s.get(e.id):null,u=null==e?void 0:e.node.current;if(u&&a&&t&&e){var h,c;let r=(0,i.sl)(u).some((t,e)=>p[e]!==t),s=S(t,e),l=(h=t,c=e,!!v(h)&&!!v(c)&&!!S(h,c)&&h.data.current.sortable.index<c.data.current.sortable.index),f=r||!s?{x:0,y:0}:{x:l?n.width-a.width:0,y:l?n.height-a.height:0},d={x:a.left,y:a.top};return f.x&&f.y?d:(0,o.Re)(d,f)}}}};function S(t,e){return!!v(t)&&!!v(e)&&t.data.current.sortable.containerId===e.data.current.sortable.containerId}},74979:function(t,e,r){r.d(e,{$$:()=>m,Es:()=>f,KG:()=>y,Ks:()=>I,Ll:()=>l,Re:()=>M,Sw:()=>o,TW:()=>u,WQ:()=>x,YG:()=>k,YN:()=>g,ZC:()=>v,_q:()=>d,ag:()=>N,e_:()=>C,jn:()=>i,kx:()=>R,l6:()=>s,lk:()=>w,sb:()=>h,wz:()=>p,xZ:()=>c,zk:()=>a});var n=r(17402);function i(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return(0,n.useMemo)(()=>t=>{e.forEach(e=>e(t))},e)}let o="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function s(t){let e=Object.prototype.toString.call(t);return"[object Window]"===e||"[object global]"===e}function l(t){return"nodeType"in t}function a(t){var e,r;return t?s(t)?t:l(t)&&null!=(e=null==(r=t.ownerDocument)?void 0:r.defaultView)?e:window:window}function p(t){let{Document:e}=a(t);return t instanceof e}function h(t){return!s(t)&&t instanceof a(t).HTMLElement}function c(t){return t instanceof a(t).SVGElement}function u(t){return t?s(t)?t.document:l(t)?p(t)?t:h(t)||c(t)?t.ownerDocument:document:document:document}let f=o?n.useLayoutEffect:n.useEffect;function d(t){let e=(0,n.useRef)(t);return f(()=>{e.current=t}),(0,n.useCallback)(function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return null==e.current?void 0:e.current(...r)},[])}function m(){let t=(0,n.useRef)(null);return[(0,n.useCallback)((e,r)=>{t.current=setInterval(e,r)},[]),(0,n.useCallback)(()=>{null!==t.current&&(clearInterval(t.current),t.current=null)},[])]}function g(t,e){void 0===e&&(e=[t]);let r=(0,n.useRef)(t);return f(()=>{r.current!==t&&(r.current=t)},e),r}function y(t,e){let r=(0,n.useRef)();return(0,n.useMemo)(()=>{let e=t(r.current);return r.current=e,e},[...e])}function w(t){let e=d(t),r=(0,n.useRef)(null),i=(0,n.useCallback)(t=>{t!==r.current&&(null==e||e(t,r.current)),r.current=t},[]);return[r,i]}function v(t){let e=(0,n.useRef)();return(0,n.useEffect)(()=>{e.current=t},[t]),e.current}let b={};function k(t,e){return(0,n.useMemo)(()=>{if(e)return e;let r=null==b[t]?0:b[t]+1;return b[t]=r,t+"-"+r},[t,e])}function S(t){return function(e){for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.reduce((e,r)=>{for(let[n,i]of Object.entries(r)){let r=e[n];null!=r&&(e[n]=r+t*i)}return e},{...e})}}let x=S(1),M=S(-1);function R(t){if(!t)return!1;let{KeyboardEvent:e}=a(t.target);return e&&t instanceof e}function C(t){if(function(t){if(!t)return!1;let{TouchEvent:e}=a(t.target);return e&&t instanceof e}(t)){if(t.touches&&t.touches.length){let{clientX:e,clientY:r}=t.touches[0];return{x:e,y:r}}else if(t.changedTouches&&t.changedTouches.length){let{clientX:e,clientY:r}=t.changedTouches[0];return{x:e,y:r}}}return"clientX"in t&&"clientY"in t?{x:t.clientX,y:t.clientY}:null}let I=Object.freeze({Translate:{toString(t){if(!t)return;let{x:e,y:r}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;let{scaleX:e,scaleY:r}=t;return"scaleX("+e+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[I.Translate.toString(t),I.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:r,easing:n}=t;return e+" "+r+"ms "+n}}}),J="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function N(t){return t.matches(J)?t:t.querySelector(J)}},97070:function(t,e,r){r.d(e,{$L:()=>N,Ln:()=>m,N0:()=>I,Um:()=>J,Wg:()=>g,X9:()=>s,dL:()=>j,jP:()=>v,n9:()=>R,oM:()=>b,zy:()=>M});var n=r(579);class i{constructor(t,e,r){this.pos=t,this.delInfo=e,this.recover=r}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class o{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&o.empty)return o.empty}recover(t){let e=0,r=65535&t;if(!this.inverted)for(let t=0;t<r;t++)e+=this.ranges[3*t+2]-this.ranges[3*t+1];return this.ranges[3*r]+e+(t-(65535&t))/65536}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,r){let n=0,o=this.inverted?2:1,s=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?n:0);if(a>t)break;let p=this.ranges[l+o],h=this.ranges[l+s],c=a+p;if(t<=c){let o=p?t==a?-1:t==c?1:e:e,s=a+n+(o<0?0:h);if(r)return s;let u=t==(e<0?a:c)?null:l/3+(t-a)*65536,f=t==a?2:t==c?1:4;return(e<0?t!=a:t!=c)&&(f|=8),new i(s,f,u)}n+=h-p}return r?t+n:new i(t+n,0,null)}touches(t,e){let r=0,n=65535&e,i=this.inverted?2:1,o=this.inverted?1:2;for(let e=0;e<this.ranges.length;e+=3){let s=this.ranges[e]-(this.inverted?r:0);if(s>t)break;let l=this.ranges[e+i];if(t<=s+l&&e==3*n)return!0;r+=this.ranges[e+o]-l}return!1}forEach(t){let e=this.inverted?2:1,r=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let o=this.ranges[n],s=o-(this.inverted?i:0),l=o+(this.inverted?0:i),a=this.ranges[n+e],p=this.ranges[n+r];t(s,s+a,l,l+p),i+=p-a}}invert(){return new o(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?o.empty:new o(t<0?[0,-t,0]:[0,0,t])}}o.empty=new o([]);class s{constructor(t,e,r=0,n=t?t.length:0){this.mirror=e,this.from=r,this.to=n,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new s(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),null!=e&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,r=this._maps.length;e<t._maps.length;e++){let n=t.getMirror(e);this.appendMap(t._maps[e],null!=n&&n<e?r+n:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,r=this._maps.length+t._maps.length;e>=0;e--){let n=t.getMirror(e);this.appendMap(t._maps[e].invert(),null!=n&&n>e?r-n-1:void 0)}}invert(){let t=new s;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let r=this.from;r<this.to;r++)t=this._maps[r].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,r){let n=0;for(let r=this.from;r<this.to;r++){let i=this._maps[r].mapResult(t,e);if(null!=i.recover){let e=this.getMirror(r);if(null!=e&&e>r&&e<this.to){r=e,t=this._maps[e].recover(i.recover);continue}}n|=i.delInfo,t=i.pos}return r?t:new i(t,n,null)}}let l=Object.create(null);class a{getMap(){return o.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw RangeError("Invalid input for Step.fromJSON");let r=l[e.stepType];if(!r)throw RangeError(`No step type ${e.stepType} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in l)throw RangeError("Duplicate use of step JSON ID "+t);return l[t]=e,e.prototype.jsonID=t,e}}class p{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new p(t,null)}static fail(t){return new p(null,t)}static fromReplace(t,e,r,i){try{return p.ok(t.replace(e,r,i))}catch(t){if(t instanceof n.vI)return p.fail(t.message);throw t}}}function h(t,e,r){let i=[];for(let n=0;n<t.childCount;n++){let o=t.child(n);o.content.size&&(o=o.copy(h(o.content,e,o))),o.isInline&&(o=e(o,r,n)),i.push(o)}return n.FK.fromArray(i)}class c extends a{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=t.resolve(this.from),i=r.node(r.sharedDepth(this.to)),o=new n.Ji(h(e.content,(t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t,i),e.openStart,e.openEnd);return p.fromReplace(t,this.from,this.to,o)}invert(){return new u(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new c(e.pos,r.pos,this.mark)}merge(t){return t instanceof c&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new c(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw RangeError("Invalid input for AddMarkStep.fromJSON");return new c(e.from,e.to,t.markFromJSON(e.mark))}}a.jsonID("addMark",c);class u extends a{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(t){let e=t.slice(this.from,this.to),r=new n.Ji(h(e.content,t=>t.mark(this.mark.removeFromSet(t.marks)),t),e.openStart,e.openEnd);return p.fromReplace(t,this.from,this.to,r)}invert(){return new c(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new u(e.pos,r.pos,this.mark)}merge(t){return t instanceof u&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new u(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw RangeError("Invalid input for RemoveMarkStep.fromJSON");return new u(e.from,e.to,t.markFromJSON(e.mark))}}a.jsonID("removeMark",u);class f extends a{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return p.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return p.fromReplace(t,this.pos,this.pos+1,new n.Ji(n.FK.from(r),0,+!e.isLeaf))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(t))return new f(this.pos,e.marks[r]);return new f(this.pos,this.mark)}}return new d(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new f(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new f(e.pos,t.markFromJSON(e.mark))}}a.jsonID("addNodeMark",f);class d extends a{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return p.fail("No node at mark step's position");let r=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return p.fromReplace(t,this.pos,this.pos+1,new n.Ji(n.FK.from(r),0,+!e.isLeaf))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new f(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new d(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new d(e.pos,t.markFromJSON(e.mark))}}a.jsonID("removeNodeMark",d);class m extends a{constructor(t,e,r,n=!1){super(),this.from=t,this.to=e,this.slice=r,this.structure=n}apply(t){return this.structure&&y(t,this.from,this.to)?p.fail("Structure replace would overwrite content"):p.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new o([this.from,this.to-this.from,this.slice.size])}invert(t){return new m(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deletedAcross&&r.deletedAcross?null:new m(e.pos,Math.max(e.pos,r.pos),this.slice,this.structure)}merge(t){if(!(t instanceof m)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart)if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;else{let e=this.slice.size+t.slice.size==0?n.Ji.empty:new n.Ji(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new m(t.from,this.to,e,this.structure)}{let e=this.slice.size+t.slice.size==0?n.Ji.empty:new n.Ji(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new m(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw RangeError("Invalid input for ReplaceStep.fromJSON");return new m(e.from,e.to,n.Ji.fromJSON(t,e.slice),!!e.structure)}}a.jsonID("replace",m);class g extends a{constructor(t,e,r,n,i,o,s=!1){super(),this.from=t,this.to=e,this.gapFrom=r,this.gapTo=n,this.slice=i,this.insert=o,this.structure=s}apply(t){if(this.structure&&(y(t,this.from,this.gapFrom)||y(t,this.gapTo,this.to)))return p.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return p.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,e.content);return r?p.fromReplace(t,this.from,this.to,r):p.fail("Content does not fit in gap")}getMap(){return new o([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new g(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),n=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:t.map(this.gapTo,1);return e.deletedAcross&&r.deletedAcross||n<e.pos||i>r.pos?null:new g(e.pos,r.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new g(e.from,e.to,e.gapFrom,e.gapTo,n.Ji.fromJSON(t,e.slice),e.insert,!!e.structure)}}function y(t,e,r){let n=t.resolve(e),i=r-e,o=n.depth;for(;i>0&&o>0&&n.indexAfter(o)==n.node(o).childCount;)o--,i--;if(i>0){let t=n.node(o).maybeChild(n.indexAfter(o));for(;i>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}function w(t,e,r,i=r.contentMatch,o=!0){let s=t.doc.nodeAt(e),l=[],a=e+1;for(let e=0;e<s.childCount;e++){let p=s.child(e),h=a+p.nodeSize,c=i.matchType(p.type);if(c){i=c;for(let e=0;e<p.marks.length;e++)r.allowsMarkType(p.marks[e].type)||t.step(new u(a,h,p.marks[e]));if(o&&p.isText&&"pre"!=r.whitespace){let t,e=/\r?\n|\r/g,i;for(;t=e.exec(p.text);)i||(i=new n.Ji(n.FK.from(r.schema.text(" ",r.allowedMarks(p.marks))),0,0)),l.push(new m(a+t.index,a+t.index+t[0].length,i))}}else l.push(new m(a,h,n.Ji.empty));a=h}if(!i.validEnd){let e=i.fillBefore(n.FK.empty,!0);t.replace(a,a,new n.Ji(e,0,0))}for(let e=l.length-1;e>=0;e--)t.step(l[e])}function v(t){let e=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let n=t.$from.node(r),i=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&n.canReplace(i,o,e))return r;if(0==r||n.type.spec.isolating||!((0==i||n.canReplace(i,n.childCount))&&(o==n.childCount||n.canReplace(0,o))))break}return null}function b(t,e,r=null,n=t){let i=function(t,e){let{parent:r,startIndex:n,endIndex:i}=t,o=r.contentMatchAt(n).findWrapping(e);if(!o)return null;let s=o.length?o[0]:e;return r.canReplaceWith(n,i,s)?o:null}(t,e),o=i&&function(t,e){let{parent:r,startIndex:n,endIndex:i}=t,o=r.child(n),s=e.contentMatch.findWrapping(o.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let t=n;l&&t<i;t++)l=l.matchType(r.child(t).type);return l&&l.validEnd?s:null}(n,e);return o?i.map(k).concat({type:e,attrs:r}).concat(o.map(k)):null}function k(t){return{type:t,attrs:null}}function S(t,e,r,n){e.forEach((i,o)=>{if(i.isText){let s,l=/\r?\n|\r/g;for(;s=l.exec(i.text);){let i=t.mapping.slice(n).map(r+1+o+s.index);t.replaceWith(i,i+1,e.type.schema.linebreakReplacement.create())}}})}function x(t,e,r,n){e.forEach((i,o)=>{if(i.type==i.type.schema.linebreakReplacement){let i=t.mapping.slice(n).map(r+1+o);t.replaceWith(i,i+1,e.type.schema.text("\n"))}})}function M(t,e,r=1,n){let i=t.resolve(e),o=i.depth-r,s=n&&n[n.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let t=i.depth-1,e=r-2;t>o;t--,e--){let r=i.node(t),o=i.index(t);if(r.type.spec.isolating)return!1;let s=r.content.cutByIndex(o,r.childCount),l=n&&n[e+1];l&&(s=s.replaceChild(0,l.type.create(l.attrs)));let a=n&&n[e]||r;if(!r.canReplace(o+1,r.childCount)||!a.type.validContent(s))return!1}let l=i.indexAfter(o),a=n&&n[0];return i.node(o).canReplaceWith(l,l,a?a.type:i.node(o+1).type)}function R(t,e){let r=t.resolve(e),n=r.index();return C(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function C(t,e){return!!(t&&e&&!t.isLeaf&&function(t,e){e.content.size||t.type.compatibleContent(e.type);let r=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let i=0;i<e.childCount;i++){let o=e.child(i),s=o.type==n?t.type.schema.nodes.text:o.type;if(!(r=r.matchType(s))||!t.type.allowsMarks(o.marks))return!1}return r.validEnd}(t,e))}function I(t,e,r=-1){let n=t.resolve(e);for(let t=n.depth;;t--){let i,o,s=n.index(t);if(t==n.depth?(i=n.nodeBefore,o=n.nodeAfter):r>0?(i=n.node(t+1),s++,o=n.node(t).maybeChild(s)):(i=n.node(t).maybeChild(s-1),o=n.node(t+1)),i&&!i.isTextblock&&C(i,o)&&n.node(t).canReplace(s,s+1))return e;if(0==t)break;e=r<0?n.before(t):n.after(t)}}function J(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let t=0;t<r.openStart;t++)i=i.firstChild.content;for(let t=1;t<=(0==r.openStart&&r.size?2:1);t++)for(let e=n.depth;e>=0;e--){let r=e==n.depth?0:n.pos<=(n.start(e+1)+n.end(e+1))/2?-1:1,o=n.index(e)+ +(r>0),s=n.node(e),l=!1;if(1==t)l=s.canReplace(o,o,i);else{let t=s.contentMatchAt(o).findWrapping(i.firstChild.type);l=t&&s.canReplaceWith(o,o,t[0])}if(l)return 0==r?n.pos:r<0?n.before(e+1):n.after(e+1)}return null}function N(t,e,r=e,i=n.Ji.empty){if(e==r&&!i.size)return null;let o=t.resolve(e),s=t.resolve(r);return T(o,s,i)?new m(e,r,i):new E(o,s,i).fit()}function T(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}a.jsonID("replaceAround",g);class E{constructor(t,e,r){this.$from=t,this.$to=e,this.unplaced=r,this.frontier=[],this.placed=n.FK.empty;for(let e=0;e<=t.depth;e++){let r=t.node(e);this.frontier.push({type:r.type,match:r.contentMatchAt(t.indexAfter(e))})}for(let e=t.depth;e>0;e--)this.placed=n.FK.from(t.node(e).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(t<0?this.$to:r.doc.resolve(t));if(!i)return null;let o=this.placed,s=r.depth,l=i.depth;for(;s&&l&&1==o.childCount;)o=o.firstChild.content,s--,l--;let a=new n.Ji(o,s,l);return t>-1?new g(r.pos,t,this.$to.pos,this.$to.end(),a,e):a.size||r.pos!=this.$to.pos?new m(r.pos,i.pos,a):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,r=0,n=this.unplaced.openEnd;r<t;r++){let i=e.firstChild;if(e.childCount>1&&(n=0),i.type.spec.isolating&&n<=r){t=r;break}e=i.content}for(let e=1;e<=2;e++)for(let r=1==e?t:this.unplaced.openStart;r>=0;r--){let t=null,i=(r?(t=A(this.unplaced.content,r-1).firstChild).content:this.unplaced.content).firstChild;for(let o=this.depth;o>=0;o--){let{type:s,match:l}=this.frontier[o],a,p=null;if(1==e&&(i?l.matchType(i.type)||(p=l.fillBefore(n.FK.from(i),!1)):t&&s.compatibleContent(t.type)))return{sliceDepth:r,frontierDepth:o,parent:t,inject:p};if(2==e&&i&&(a=l.findWrapping(i.type)))return{sliceDepth:r,frontierDepth:o,parent:t,wrap:a};if(t&&l.matchType(t.type))break}}}openMore(){let{content:t,openStart:e,openEnd:r}=this.unplaced,i=A(t,e);return!!i.childCount&&!i.firstChild.isLeaf&&(this.unplaced=new n.Ji(t,e+1,Math.max(r,i.size+e>=t.size-r?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:r}=this.unplaced,i=A(t,e);if(i.childCount<=1&&e>0){let o=t.size-e<=e+i.size;this.unplaced=new n.Ji(F(t,e-1,1),e-1,o?e-1:r)}else this.unplaced=new n.Ji(F(t,e,1),e,r)}placeNodes({sliceDepth:t,frontierDepth:e,parent:r,inject:i,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let t=0;t<o.length;t++)this.openFrontierNode(o[t]);let s=this.unplaced,l=r?r.content:s.content,a=s.openStart-t,p=0,h=[],{match:c,type:u}=this.frontier[e];if(i){for(let t=0;t<i.childCount;t++)h.push(i.child(t));c=c.matchFragment(i)}let f=l.size+t-(s.content.size-s.openEnd);for(;p<l.childCount;){let t=l.child(p),e=c.matchType(t.type);if(!e)break;(++p>1||0==a||t.content.size)&&(c=e,h.push(function t(e,r,i){if(r<=0)return e;let o=e.content;return r>1&&(o=o.replaceChild(0,t(o.firstChild,r-1,1==o.childCount?i-1:0))),r>0&&(o=e.type.contentMatch.fillBefore(o).append(o),i<=0&&(o=o.append(e.type.contentMatch.matchFragment(o).fillBefore(n.FK.empty,!0)))),e.copy(o)}(t.mark(u.allowedMarks(t.marks)),1==p?a:0,p==l.childCount?f:-1)))}let d=p==l.childCount;d||(f=-1),this.placed=O(this.placed,e,n.FK.from(h)),this.frontier[e].match=c,d&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let t=0,e=l;t<f;t++){let t=e.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),e=t.content}this.unplaced=d?0==t?n.Ji.empty:new n.Ji(F(s.content,t-1,1),t-1,f<0?s.openEnd:t-1):new n.Ji(F(s.content,t,p),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return -1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!z(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return -1;let{depth:r}=this.$to,n=this.$to.after(r);for(;r>1&&n==this.$to.end(--r);)++n;return n}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:r,type:n}=this.frontier[e],i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),o=z(t,e,n,r,i);if(o){for(let r=e-1;r>=0;r--){let{match:e,type:n}=this.frontier[r],i=z(t,r,n,e,!0);if(!i||i.childCount)continue t}return{depth:e,fit:o,move:i?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=O(this.placed,e.depth,e.fit)),t=e.move;for(let r=e.depth+1;r<=t.depth;r++){let e=t.node(r),n=e.type.contentMatch.fillBefore(e.content,!0,t.index(r));this.openFrontierNode(e.type,e.attrs,n)}return t}openFrontierNode(t,e=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=O(this.placed,this.depth,n.FK.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(n.FK.empty,!0);t.childCount&&(this.placed=O(this.placed,this.frontier.length,t))}}function F(t,e,r){return 0==e?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(F(t.firstChild.content,e-1,r)))}function O(t,e,r){return 0==e?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(O(t.lastChild.content,e-1,r)))}function A(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function z(t,e,r,n,i){let o=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==o.childCount&&!r.compatibleContent(o.type))return null;let l=n.fillBefore(o.content,!0,s);return l&&!function(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}(r,o.content,s)?l:null}function _(t,e){let r=[],n=Math.min(t.depth,e.depth);for(let i=n;i>=0;i--){let n=t.start(i);if(n<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(n==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==n-1)&&r.push(i)}return r}class K extends a{constructor(t,e,r){super(),this.pos=t,this.attr=e,this.value=r}apply(t){let e=t.nodeAt(this.pos);if(!e)return p.fail("No node at attribute step's position");let r=Object.create(null);for(let t in e.attrs)r[t]=e.attrs[t];r[this.attr]=this.value;let i=e.type.create(r,null,e.marks);return p.fromReplace(t,this.pos,this.pos+1,new n.Ji(n.FK.from(i),0,+!e.isLeaf))}getMap(){return o.empty}invert(t){return new K(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new K(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw RangeError("Invalid input for AttrStep.fromJSON");return new K(e.pos,e.attr,e.value)}}a.jsonID("attr",K);class D extends a{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let r in t.attrs)e[r]=t.attrs[r];e[this.attr]=this.value;let r=t.type.create(e,t.content,t.marks);return p.ok(r)}getMap(){return o.empty}invert(t){return new D(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if("string"!=typeof e.attr)throw RangeError("Invalid input for DocAttrStep.fromJSON");return new D(e.attr,e.value)}}a.jsonID("docAttr",D);let L=class extends Error{};(L=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r}).prototype=Object.create(Error.prototype),L.prototype.constructor=L,L.prototype.name="TransformError";class j{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new s}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new L(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,r=n.Ji.empty){let i=N(this.doc,t,e,r);return i&&this.step(i),this}replaceWith(t,e,r){return this.replace(t,e,new n.Ji(n.FK.from(r),0,0))}delete(t,e){return this.replace(t,e,n.Ji.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,r){return!function(t,e,r,i){if(!i.size)return t.deleteRange(e,r);let o=t.doc.resolve(e),s=t.doc.resolve(r);if(T(o,s,i))return t.step(new m(e,r,i));let l=_(o,t.doc.resolve(r));0==l[l.length-1]&&l.pop();let a=-(o.depth+1);l.unshift(a);for(let t=o.depth,e=o.pos-1;t>0;t--,e--){let r=o.node(t).type.spec;if(r.defining||r.definingAsContext||r.isolating)break;l.indexOf(t)>-1?a=t:o.before(t)==e&&l.splice(1,0,-t)}let p=l.indexOf(a),h=[],c=i.openStart;for(let t=i.content,e=0;;e++){let r=t.firstChild;if(h.push(r),e==i.openStart)break;t=r.content}for(let t=c-1;t>=0;t--){var u;let e=h[t],r=(u=e.type).spec.defining||u.spec.definingForContent;if(r&&!e.sameMarkup(o.node(Math.abs(a)-1)))c=t;else if(r||!e.type.isTextblock)break}for(let e=i.openStart;e>=0;e--){let a=(e+c+1)%(i.openStart+1),u=h[a];if(u)for(let e=0;e<l.length;e++){let h=l[(e+p)%l.length],c=!0;h<0&&(c=!1,h=-h);let f=o.node(h-1),d=o.index(h-1);if(f.canReplaceWith(d,d,u.type,u.marks))return t.replace(o.before(h),c?s.after(h):r,new n.Ji(function t(e,r,i,o,s){if(r<i){let n=e.firstChild;e=e.replaceChild(0,n.copy(t(n.content,r+1,i,o,n)))}if(r>o){let t=s.contentMatchAt(0),r=t.fillBefore(e).append(e);e=r.append(t.matchFragment(r).fillBefore(n.FK.empty,!0))}return e}(i.content,0,i.openStart,a),a,i.openEnd))}}let f=t.steps.length;for(let n=l.length-1;n>=0&&(t.replace(e,r,i),!(t.steps.length>f));n--){let t=l[n];t<0||(e=o.before(t),r=s.after(t))}}(this,t,e,r),this}replaceRangeWith(t,e,r){var i=t,o=e;if(!r.isInline&&i==o&&this.doc.resolve(i).parent.content.size){let t=function(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(0==n.parentOffset)for(let t=n.depth-1;t>=0;t--){let e=n.index(t);if(n.node(t).canReplaceWith(e,e,r))return n.before(t+1);if(e>0)return null}if(n.parentOffset==n.parent.content.size)for(let t=n.depth-1;t>=0;t--){let e=n.indexAfter(t);if(n.node(t).canReplaceWith(e,e,r))return n.after(t+1);if(e<n.node(t).childCount)break}return null}(this.doc,i,r.type);null!=t&&(i=o=t)}return this.replaceRange(i,o,new n.Ji(n.FK.from(r),0,0)),this}deleteRange(t,e){return!function(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),o=_(n,i);for(let e=0;e<o.length;e++){let r=o[e],s=e==o.length-1;if(s&&0==r||n.node(r).type.contentMatch.validEnd)return t.delete(n.start(r),i.end(r));if(r>0&&(s||n.node(r-1).canReplace(n.index(r-1),i.indexAfter(r-1))))return t.delete(n.before(r),i.after(r))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&r>n.end(o)&&i.end(o)-r!=i.depth-o&&n.start(o-1)==i.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),i.index(o-1)))return t.delete(n.before(o),r);t.delete(e,r)}(this,t,e),this}lift(t,e){return!function(t,e,r){let{$from:i,$to:o,depth:s}=e,l=i.before(s+1),a=o.after(s+1),p=l,h=a,c=n.FK.empty,u=0;for(let t=s,e=!1;t>r;t--)e||i.index(t)>0?(e=!0,c=n.FK.from(i.node(t).copy(c)),u++):p--;let f=n.FK.empty,d=0;for(let t=s,e=!1;t>r;t--)e||o.after(t+1)<o.end(t)?(e=!0,f=n.FK.from(o.node(t).copy(f)),d++):h++;t.step(new g(p,h,l,a,new n.Ji(c.append(f),u,d),c.size-u,!0))}(this,t,e),this}join(t,e=1){return!function(t,e,r){let i=null,{linebreakReplacement:o}=t.doc.type.schema,s=t.doc.resolve(e-r),l=s.node().type;if(o&&l.inlineContent){let t="pre"==l.whitespace,e=!!l.contentMatch.matchType(o);t&&!e?i=!1:!t&&e&&(i=!0)}let a=t.steps.length;if(!1===i){let n=t.doc.resolve(e+r);x(t,n.node(),n.before(),a)}l.inlineContent&&w(t,e+r-1,l,s.node().contentMatchAt(s.index()),null==i);let p=t.mapping.slice(a),h=p.map(e-r);if(t.step(new m(h,p.map(e+r,-1),n.Ji.empty,!0)),!0===i){let e=t.doc.resolve(h);S(t,e.node(),e.before(),t.steps.length)}}(this,t,e),this}wrap(t,e){return!function(t,e,r){let i=n.FK.empty;for(let t=r.length-1;t>=0;t--){if(i.size){let e=r[t].type.contentMatch.matchFragment(i);if(!e||!e.validEnd)throw RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=n.FK.from(r[t].type.create(r[t].attrs,i))}let o=e.start,s=e.end;t.step(new g(o,s,o,s,new n.Ji(i,0,0),r.length,!0))}(this,t,e),this}setBlockType(t,e=t,r,i=null){var o=this;if(!r.isTextblock)throw RangeError("Type given to setBlockType should be a textblock");let s=o.steps.length;return o.doc.nodesBetween(t,e,(t,e)=>{var l,a,p;let h,c,u="function"==typeof i?i(t):i;if(t.isTextblock&&!t.hasMarkup(r,u)&&(l=o.doc,a=o.mapping.slice(s).map(e),p=r,c=(h=l.resolve(a)).index(),h.parent.canReplaceWith(c,c+1,p))){let i=null;if(r.schema.linebreakReplacement){let t="pre"==r.whitespace,e=!!r.contentMatch.matchType(r.schema.linebreakReplacement);t&&!e?i=!1:!t&&e&&(i=!0)}!1===i&&x(o,t,e,s),w(o,o.mapping.slice(s).map(e,1),r,void 0,null===i);let l=o.mapping.slice(s),a=l.map(e,1),p=l.map(e+t.nodeSize,1);return o.step(new g(a,p,a+1,p-1,new n.Ji(n.FK.from(r.create(u,null,t.marks)),0,0),1,!0)),!0===i&&S(o,t,e,s),!1}}),this}setNodeMarkup(t,e,r=null,i){return!function(t,e,r,i,o){let s=t.doc.nodeAt(e);if(!s)throw RangeError("No node at given position");r||(r=s.type);let l=r.create(i,null,o||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,l);if(!r.validContent(s.content))throw RangeError("Invalid content for node type "+r.name);t.step(new g(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new n.Ji(n.FK.from(l),0,0),1,!0))}(this,t,e,r,i),this}setNodeAttribute(t,e,r){return this.step(new K(t,e,r)),this}setDocAttribute(t,e){return this.step(new D(t,e)),this}addNodeMark(t,e){return this.step(new f(t,e)),this}removeNodeMark(t,e){let r=this.doc.nodeAt(t);if(!r)throw RangeError("No node at position "+t);if(e instanceof n.CU)e.isInSet(r.marks)&&this.step(new d(t,e));else{let n=r.marks,i,o=[];for(;i=e.isInSet(n);)o.push(new d(t,i)),n=i.removeFromSet(n);for(let t=o.length-1;t>=0;t--)this.step(o[t])}return this}split(t,e=1,r){return!function(t,e,r=1,i){let o=t.doc.resolve(e),s=n.FK.empty,l=n.FK.empty;for(let t=o.depth,e=o.depth-r,a=r-1;t>e;t--,a--){s=n.FK.from(o.node(t).copy(s));let e=i&&i[a];l=n.FK.from(e?e.type.create(e.attrs,l):o.node(t).copy(l))}t.step(new m(e,e,new n.Ji(s.append(l),r,r),!0))}(this,t,e,r),this}addMark(t,e,r){var n;let i,o,s,l;return n=this,s=[],l=[],n.doc.nodesBetween(t,e,(n,a,p)=>{if(!n.isInline)return;let h=n.marks;if(!r.isInSet(h)&&p.type.allowsMarkType(r.type)){let p=Math.max(a,t),f=Math.min(a+n.nodeSize,e),d=r.addToSet(h);for(let t=0;t<h.length;t++)h[t].isInSet(d)||(i&&i.to==p&&i.mark.eq(h[t])?i.to=f:s.push(i=new u(p,f,h[t])));o&&o.to==p?o.to=f:l.push(o=new c(p,f,r))}}),s.forEach(t=>n.step(t)),l.forEach(t=>n.step(t)),this}removeMark(t,e,r){var i;let o,s;return i=this,o=[],s=0,i.doc.nodesBetween(t,e,(i,l)=>{if(!i.isInline)return;s++;let a=null;if(r instanceof n.sX){let t=i.marks,e;for(;e=r.isInSet(t);)(a||(a=[])).push(e),t=e.removeFromSet(t)}else r?r.isInSet(i.marks)&&(a=[r]):a=i.marks;if(a&&a.length){let r=Math.min(l+i.nodeSize,e);for(let e=0;e<a.length;e++){let n=a[e],i;for(let t=0;t<o.length;t++){let e=o[t];e.step==s-1&&n.eq(o[t].style)&&(i=e)}i?(i.to=r,i.step=s):o.push({style:n,from:Math.max(l,t),to:r,step:s})}}}),o.forEach(t=>i.step(new u(t.from,t.to,t.style))),this}clearIncompatible(t,e,r){return w(this,t,e,r),this}}}}]);