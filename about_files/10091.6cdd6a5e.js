!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e.SENTRY_RELEASE={id:"substack@af5f699"};var t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c122371c-57fd-4c0d-ae8f-b8fce2cbbe93",e._sentryDebugIdIdentifier="sentry-dbid-c122371c-57fd-4c0d-ae8f-b8fce2cbbe93")}catch(e){}}(),(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["10091"],{95201:function(e,t,n){e.exports=n(67358).default},33031:function(e,t,n){var r=n(83120),o=n(46155),i=n(69302),s=n(36800);e.exports=i(function(e,t){if(null==e)return[];var n=t.length;return n>1&&s(e,t[0],t[1])?t=[]:n>2&&s(t[0],t[1],t[2])&&(t=[t[0]]),o(e,r(t,1),[])})},67502:function(e,t,n){"use strict";n.d(t,{b:()=>p});var r=n(17402),o=n(29607),i=n(97372),s=n(73550),l=n(4006),c="Toggle",a=r.forwardRef((e,t)=>{let{pressed:n,defaultPressed:r,onPressedChange:a,...p}=e,[d,f]=(0,i.i)({prop:n,onChange:a,defaultProp:r??!1,caller:c});return(0,l.Y)(s.sG.button,{type:"button","aria-pressed":d,"data-state":d?"on":"off","data-disabled":e.disabled?"":void 0,...p,ref:t,onClick:(0,o.mK)(e.onClick,()=>{e.disabled||f(!d)})})});a.displayName=c;var p=a},52674:function(e,t,n){"use strict";n.d(t,{$f:()=>J,G2:()=>w,I$:()=>v,Im:()=>N,Qv:()=>c,Sd:()=>y,Z1:()=>$,_G:()=>p,_e:()=>u,bh:()=>S,eB:()=>a,eT:()=>g,ec:()=>F,hy:()=>M,ic:()=>s,iz:()=>C,pC:()=>I,yY:()=>b,y_:()=>R});var r=n(97070),o=n(579),i=n(26469);let s=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function l(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("backward",e):!(n.parentOffset>0))?n:null}let c=(e,t,n)=>{let s=l(e,n);if(!s)return!1;let c=h(s);if(!c){let n=s.blockRange(),o=n&&(0,r.jP)(n);return null!=o&&(t&&t(e.tr.lift(n,o).scrollIntoView()),!0)}let a=c.nodeBefore;if(T(e,c,t,-1))return!0;if(0==s.parent.content.size&&(f(a,"end")||i.nh.isSelectable(a)))for(let n=s.depth;;n--){let l=(0,r.$L)(e.doc,s.before(n),s.after(n),o.Ji.empty);if(l&&l.slice.size<l.to-l.from){if(t){let n=e.tr.step(l);n.setSelection(f(a,"end")?i.LN.findFrom(n.doc.resolve(n.mapping.map(c.pos,-1)),-1):i.nh.create(n.doc,c.pos-a.nodeSize)),t(n.scrollIntoView())}return!0}if(1==n||s.node(n-1).childCount>1)break}return!!a.isAtom&&c.depth==s.depth-1&&(t&&t(e.tr.delete(c.pos-a.nodeSize,c.pos).scrollIntoView()),!0)},a=(e,t,n)=>{let r=l(e,n);if(!r)return!1;let o=h(r);return!!o&&d(e,o,t)},p=(e,t,n)=>{let r=m(e,n);if(!r)return!1;let o=k(r);return!!o&&d(e,o,t)};function d(e,t,n){let s=t.nodeBefore,l=t.pos-1;for(;!s.isTextblock;l--){if(s.type.spec.isolating)return!1;let e=s.lastChild;if(!e)return!1;s=e}let c=t.nodeAfter,a=t.pos+1;for(;!c.isTextblock;a++){if(c.type.spec.isolating)return!1;let e=c.firstChild;if(!e)return!1;c=e}let p=(0,r.$L)(e.doc,l,a,o.Ji.empty);if(!p||p.from!=l||p instanceof r.Ln&&p.slice.size>=a-l)return!1;if(n){let t=e.tr.step(p);t.setSelection(i.U3.create(t.doc,l)),n(t.scrollIntoView())}return!0}function f(e,t,n=!1){for(let r=e;r;r="start"==t?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)break}return!1}let u=(e,t,n)=>{let{$head:r,empty:o}=e.selection,s=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):r.parentOffset>0)return!1;s=h(r)}let l=s&&s.nodeBefore;return!!l&&!!i.nh.isSelectable(l)&&(t&&t(e.tr.setSelection(i.nh.create(e.doc,s.pos-l.nodeSize)).scrollIntoView()),!0)};function h(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function m(e,t){let{$cursor:n}=e.selection;return n&&(t?t.endOfTextblock("forward",e):!(n.parentOffset<n.parent.content.size))?n:null}let g=(e,t,n)=>{let s=m(e,n);if(!s)return!1;let l=k(s);if(!l)return!1;let c=l.nodeAfter;if(T(e,l,t,1))return!0;if(0==s.parent.content.size&&(f(c,"start")||i.nh.isSelectable(c))){let n=(0,r.$L)(e.doc,s.before(),s.after(),o.Ji.empty);if(n&&n.slice.size<n.to-n.from){if(t){let r=e.tr.step(n);r.setSelection(f(c,"start")?i.LN.findFrom(r.doc.resolve(r.mapping.map(l.pos)),1):i.nh.create(r.doc,r.mapping.map(l.pos))),t(r.scrollIntoView())}return!0}}return!!c.isAtom&&l.depth==s.depth-1&&(t&&t(e.tr.delete(l.pos,l.pos+c.nodeSize).scrollIntoView()),!0)},y=(e,t,n)=>{let{$head:r,empty:o}=e.selection,s=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)return!1;s=k(r)}let l=s&&s.nodeAfter;return!!l&&!!i.nh.isSelectable(l)&&(t&&t(e.tr.setSelection(i.nh.create(e.doc,s.pos)).scrollIntoView()),!0)};function k(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}let w=(e,t)=>{let n=e.selection,o=n instanceof i.nh,s;if(o){if(n.node.isTextblock||!(0,r.n9)(e.doc,n.from))return!1;s=n.from}else if(null==(s=(0,r.N0)(e.doc,n.from,-1)))return!1;if(t){let n=e.tr.join(s);o&&n.setSelection(i.nh.create(n.doc,s-e.doc.resolve(s).nodeBefore.nodeSize)),t(n.scrollIntoView())}return!0},S=(e,t)=>{let n=e.selection,o;if(n instanceof i.nh){if(n.node.isTextblock||!(0,r.n9)(e.doc,n.to))return!1;o=n.to}else if(null==(o=(0,r.N0)(e.doc,n.to,1)))return!1;return t&&t(e.tr.join(o).scrollIntoView()),!0},b=(e,t)=>{let{$from:n,$to:o}=e.selection,i=n.blockRange(o),s=i&&(0,r.jP)(i);return null!=s&&(t&&t(e.tr.lift(i,s).scrollIntoView()),!0)},I=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!!n.parent.type.spec.code&&!!n.sameParent(r)&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function x(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}let v=(e,t)=>{let{$head:n,$anchor:r}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let o=n.node(-1),s=n.indexAfter(-1),l=x(o.contentMatchAt(s));if(!l||!o.canReplaceWith(s,s,l))return!1;if(t){let r=n.after(),o=e.tr.replaceWith(r,r,l.createAndFill());o.setSelection(i.LN.near(o.doc.resolve(r),1)),t(o.scrollIntoView())}return!0},$=(e,t)=>{let n=e.selection,{$from:r,$to:o}=n;if(n instanceof i.i5||r.parent.inlineContent||o.parent.inlineContent)return!1;let s=x(o.parent.contentMatchAt(o.indexAfter()));if(!s||!s.isTextblock)return!1;if(t){let n=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,l=e.tr.insert(n,s.createAndFill());l.setSelection(i.U3.create(l.doc,n+1)),t(l.scrollIntoView())}return!0},C=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if((0,r.zy)(e.doc,o))return t&&t(e.tr.split(o).scrollIntoView()),!0}let o=n.blockRange(),i=o&&(0,r.jP)(o);return null!=i&&(t&&t(e.tr.lift(o,i).scrollIntoView()),!0)},M=(e,t)=>{let{$from:n,to:r}=e.selection,o,s=n.sharedDepth(r);return 0!=s&&(o=n.before(s),t&&t(e.tr.setSelection(i.nh.create(e.doc,o))),!0)};function T(e,t,n,s){let l,c,a,p=t.nodeBefore,d=t.nodeAfter,u,h,m=p.type.spec.isolating||d.type.spec.isolating;if(!m&&(l=t.nodeBefore,c=t.nodeAfter,a=t.index(),l&&c&&l.type.compatibleContent(c.type)&&(!l.content.size&&t.parent.canReplace(a-1,a)?(n&&n(e.tr.delete(t.pos-l.nodeSize,t.pos).scrollIntoView()),!0):!!t.parent.canReplace(a,a+1)&&!!(c.isTextblock||(0,r.n9)(e.doc,t.pos))&&(n&&n(e.tr.join(t.pos).scrollIntoView()),!0))))return!0;let g=!m&&t.parent.canReplace(t.index(),t.index()+1);if(g&&(u=(h=p.contentMatchAt(p.childCount)).findWrapping(d.type))&&h.matchType(u[0]||d.type).validEnd){if(n){let i=t.pos+d.nodeSize,s=o.FK.empty;for(let e=u.length-1;e>=0;e--)s=o.FK.from(u[e].create(null,s));s=o.FK.from(p.copy(s));let l=e.tr.step(new r.Wg(t.pos-1,i,t.pos,i,new o.Ji(s,1,0),u.length,!0)),c=l.doc.resolve(i+2*u.length);c.nodeAfter&&c.nodeAfter.type==p.type&&(0,r.n9)(l.doc,c.pos)&&l.join(c.pos),n(l.scrollIntoView())}return!0}let y=d.type.spec.isolating||s>0&&m?null:i.LN.findFrom(t,1),k=y&&y.$from.blockRange(y.$to),w=k&&(0,r.jP)(k);if(null!=w&&w>=t.depth)return n&&n(e.tr.lift(k,w).scrollIntoView()),!0;if(g&&f(d,"start",!0)&&f(p,"end")){let i=p,s=[];for(;s.push(i),!i.isTextblock;)i=i.lastChild;let l=d,c=1;for(;!l.isTextblock;l=l.firstChild)c++;if(i.canReplace(i.childCount,i.childCount,l.content)){if(n){let i=o.FK.empty;for(let e=s.length-1;e>=0;e--)i=o.FK.from(s[e].copy(i));n(e.tr.step(new r.Wg(t.pos-s.length,t.pos+d.nodeSize,t.pos+c,t.pos+d.nodeSize-c,new o.Ji(i,s.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function O(e){return function(t,n){let r=t.selection,o=e<0?r.$from:r.$to,s=o.depth;for(;o.node(s).isInline;){if(!s)return!1;s--}return!!o.node(s).isTextblock&&(n&&n(t.tr.setSelection(i.U3.create(t.doc,e<0?o.start(s):o.end(s)))),!0)}}let J=O(-1),F=O(1);function N(e,t=null){return function(n,o){let{$from:i,$to:s}=n.selection,l=i.blockRange(s),c=l&&(0,r.oM)(l,e,t);return!!c&&(o&&o(n.tr.wrap(l,c).scrollIntoView()),!0)}}function R(e,t=null){return function(n,r){let o=!1;for(let r=0;r<n.selection.ranges.length&&!o;r++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[r];n.doc.nodesBetween(i,s,(r,i)=>{if(o)return!1;if(!(!r.isTextblock||r.hasMarkup(e,t)))if(r.type==e)o=!0;else{let t=n.doc.resolve(i),r=t.index();o=t.parent.canReplaceWith(r,r+1,e)}})}if(!o)return!1;if(r){let o=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[r];o.setBlockType(i,s,e,t)}r(o.scrollIntoView())}return!0}}function A(...e){return function(t,n,r){for(let o=0;o<e.length;o++)if(e[o](t,n,r))return!0;return!1}}let z=A(s,c,u),V=A(s,g,y),B={Enter:A(I,$,C,(e,t)=>{let{$from:n,$to:o}=e.selection;if(e.selection instanceof i.nh&&e.selection.node.isBlock)return!!n.parentOffset&&!!(0,r.zy)(e.doc,n.pos)&&(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let s=[],l,c,a=!1,p=!1;for(let e=n.depth;;e--){if(n.node(e).isBlock){let t;a=n.end(e)==n.pos+(n.depth-e),p=n.start(e)==n.pos-(n.depth-e),c=x(n.node(e-1).contentMatchAt(n.indexAfter(e-1)));s.unshift(t||(a&&c?{type:c}:null)),l=e;break}if(1==e)return!1;s.unshift(null)}let d=e.tr;(e.selection instanceof i.U3||e.selection instanceof i.i5)&&d.deleteSelection();let f=d.mapping.map(n.pos),u=(0,r.zy)(d.doc,f,s.length,s);if(u||(s[0]=c?{type:c}:null,u=(0,r.zy)(d.doc,f,s.length,s)),!u)return!1;if(d.split(f,s.length,s),!a&&p&&n.node(l).type!=c){let e=d.mapping.map(n.before(l)),t=d.doc.resolve(e);c&&n.node(l-1).canReplaceWith(t.index(),t.index()+1,c)&&d.setNodeMarkup(d.mapping.map(n.before(l)),c)}return t&&t(d.scrollIntoView()),!0}),"Mod-Enter":v,Backspace:z,"Mod-Backspace":z,"Shift-Backspace":z,Delete:V,"Mod-Delete":V,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new i.i5(e.doc))),!0)},E={"Ctrl-h":B.Backspace,"Alt-Backspace":B["Mod-Backspace"],"Ctrl-d":B.Delete,"Ctrl-Alt-Backspace":B["Mod-Delete"],"Alt-Delete":B["Mod-Delete"],"Alt-d":B["Mod-Delete"],"Ctrl-a":J,"Ctrl-e":F};for(let e in B)E[e]=B[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform()},9204:function(e,t,n){"use strict";n.d(t,{$B:()=>l,Sd:()=>i,T2:()=>s});var r=n(97070),o=n(579);function i(e,t=null){return function(n,i){let{$from:s,$to:l}=n.selection,c=s.blockRange(l),a=!1,p=c;if(!c)return!1;if(c.depth>=2&&s.node(c.depth-1).type.compatibleContent(e)&&0==c.startIndex){if(0==s.index(c.depth-1))return!1;let e=n.doc.resolve(c.start-2);p=new o.u$(e,e,c.depth),c.endIndex<c.parent.childCount&&(c=new o.u$(s,n.doc.resolve(l.end(c.depth)),c.depth)),a=!0}let d=(0,r.oM)(p,e,t,c);return!!d&&(i&&i((function(e,t,n,i,s){let l=o.FK.empty;for(let e=n.length-1;e>=0;e--)l=o.FK.from(n[e].type.create(n[e].attrs,l));e.step(new r.Wg(t.start-2*!!i,t.end,t.start,t.end,new o.Ji(l,0,0),n.length,!0));let c=0;for(let e=0;e<n.length;e++)n[e].type==s&&(c=e+1);let a=n.length-c,p=t.start+n.length-2*!!i,d=t.parent;for(let n=t.startIndex,o=t.endIndex,i=!0;n<o;n++,i=!1)!i&&(0,r.zy)(e.doc,p,a)&&(e.split(p,a),p+=2*a),p+=d.child(n).nodeSize;return e})(n.tr,c,d,a,e).scrollIntoView()),!0)}}function s(e){return function(t,n){let{$from:i,$to:s}=t.selection,l=i.blockRange(s,t=>t.childCount>0&&t.firstChild.type==e);return!!l&&(!n||(i.node(l.depth-1).type==e?function(e,t,n,i){let s=e.tr,l=i.end,c=i.$to.end(i.depth);l<c&&(s.step(new r.Wg(l-1,c,l,c,new o.Ji(o.FK.from(n.create(null,i.parent.copy())),1,0),1,!0)),i=new o.u$(s.doc.resolve(i.$from.pos),s.doc.resolve(c),i.depth));let a=(0,r.jP)(i);if(null==a)return!1;s.lift(i,a);let p=s.mapping.map(l,-1)-1;return(0,r.n9)(s.doc,p)&&s.join(p),t(s.scrollIntoView()),!0}(t,n,e,l):function(e,t,n){let i=e.tr,s=n.parent;for(let e=n.end,t=n.endIndex-1,r=n.startIndex;t>r;t--)e-=s.child(t).nodeSize,i.delete(e-1,e+1);let l=i.doc.resolve(n.start),c=l.nodeAfter;if(i.mapping.map(n.end)!=n.start+l.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,p=n.endIndex==s.childCount,d=l.node(-1),f=l.index(-1);if(!d.canReplace(f+ +!a,f+1,c.content.append(p?o.FK.empty:o.FK.from(s))))return!1;let u=l.pos,h=u+c.nodeSize;return i.step(new r.Wg(u-!!a,h+ +!!p,u+1,h-1,new o.Ji((a?o.FK.empty:o.FK.from(s.copy(o.FK.empty))).append(p?o.FK.empty:o.FK.from(s.copy(o.FK.empty))),+!a,+!p),+!a)),t(i.scrollIntoView()),!0}(t,n,l)))}}function l(e){return function(t,n){let{$from:i,$to:s}=t.selection,l=i.blockRange(s,t=>t.childCount>0&&t.firstChild.type==e);if(!l)return!1;let c=l.startIndex;if(0==c)return!1;let a=l.parent,p=a.child(c-1);if(p.type!=e)return!1;if(n){let i=p.lastChild&&p.lastChild.type==a.type,s=o.FK.from(i?e.create():null),c=new o.Ji(o.FK.from(e.create(null,o.FK.from(a.type.create(null,s)))),i?3:1,0),d=l.start,f=l.end;n(t.tr.step(new r.Wg(d-(i?3:1),f,d,f,c,1,!0)).scrollIntoView())}return!0}}},26469:function(e,t,n){"use strict";n.d(t,{$t:()=>x,LN:()=>s,U3:()=>p,hs:()=>M,i5:()=>h,k_:()=>v,nh:()=>f});var r=n(579),o=n(97070);let i=Object.create(null);class s{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new l(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=r.Ji.empty){let n=t.content.lastChild,o=null;for(let e=0;e<t.openEnd;e++)o=n,n=n.lastChild;let i=e.steps.length,s=this.ranges;for(let l=0;l<s.length;l++){let{$from:c,$to:a}=s[l],p=e.mapping.slice(i);e.replaceRange(p.map(c.pos),p.map(a.pos),l?r.Ji.empty:t),0==l&&y(e,i,(n?n.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let o=0;o<r.length;o++){let{$from:i,$to:s}=r[o],l=e.mapping.slice(n),c=l.map(i.pos),a=l.map(s.pos);o?e.deleteRange(c,a):(e.replaceRangeWith(c,a,t),y(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new p(e):g(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let r=e.depth-1;r>=0;r--){let o=t<0?g(e.node(0),e.node(r),e.before(r+1),e.index(r),t,n):g(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new h(e.node(0))}static atStart(e){return g(e,e,0,0,1)||new h(e)}static atEnd(e){return g(e,e,e.content.size,e.childCount,-1)||new h(e)}static fromJSON(e,t){if(!t||!t.type)throw RangeError("Invalid input for Selection.fromJSON");let n=i[t.type];if(!n)throw RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in i)throw RangeError("Duplicate use of selection JSON ID "+e);return i[e]=t,t.prototype.jsonID=e,t}getBookmark(){return p.between(this.$anchor,this.$head).getBookmark()}}s.prototype.visible=!0;class l{constructor(e,t){this.$from=e,this.$to=t}}let c=!1;function a(e){c||e.parent.inlineContent||(c=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class p extends s{constructor(e,t=e){a(e),a(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return s.near(n);let r=e.resolve(t.map(this.anchor));return new p(r.parent.inlineContent?r:n,n)}replace(e,t=r.Ji.empty){if(super.replace(e,t),t==r.Ji.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof p&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new d(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw RangeError("Invalid input for TextSelection.fromJSON");return new p(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if((!n||r)&&(n=r>=0?1:-1),!t.parent.inlineContent){let e=s.findFrom(t,n,!0)||s.findFrom(t,-n,!0);if(!e)return s.near(t,n);t=e.$head}return e.parent.inlineContent||(0==r?e=t:(e=(s.findFrom(e,-n,!0)||s.findFrom(e,n,!0)).$anchor).pos<t.pos!=r<0&&(e=t)),new p(e,t)}}s.jsonID("text",p);class d{constructor(e,t){this.anchor=e,this.head=t}map(e){return new d(e.map(this.anchor),e.map(this.head))}resolve(e){return p.between(e.resolve(this.anchor),e.resolve(this.head))}}class f extends s{constructor(e){let t=e.nodeAfter;super(e,e.node(0).resolve(e.pos+t.nodeSize)),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),o=e.resolve(r);return n?s.near(o):new f(o)}content(){return new r.Ji(r.FK.from(this.node),0,0)}eq(e){return e instanceof f&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new u(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw RangeError("Invalid input for NodeSelection.fromJSON");return new f(e.resolve(t.anchor))}static create(e,t){return new f(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}f.prototype.visible=!1,s.jsonID("node",f);class u{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new d(n,n):new u(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&f.isSelectable(n)?new f(t):s.near(t)}}class h extends s{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=r.Ji.empty){if(t==r.Ji.empty){e.delete(0,e.doc.content.size);let t=s.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new h(e)}map(e){return new h(e)}eq(e){return e instanceof h}getBookmark(){return m}}s.jsonID("all",h);let m={map(){return this},resolve:e=>new h(e)};function g(e,t,n,r,o,i=!1){if(t.inlineContent)return p.create(e,n);for(let s=r-(o>0?0:1);o>0?s<t.childCount:s>=0;s+=o){let r=t.child(s);if(r.isAtom){if(!i&&f.isSelectable(r))return f.create(e,n-(o<0?r.nodeSize:0))}else{let t=g(e,r,n+o,o<0?r.childCount:0,o,i);if(t)return t}n+=r.nodeSize*o}return null}function y(e,t,n){let r,i=e.steps.length-1;if(i<t)return;let l=e.steps[i];(l instanceof o.Ln||l instanceof o.Wg)&&(e.mapping.maps[i].forEach((e,t,n,o)=>{null==r&&(r=o)}),e.setSelection(s.near(e.doc.resolve(r),n)))}class k extends o.dL{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(1|this.updated)&-3,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return r.CU.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||r.CU.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let o=this.storedMarks;if(!o){let e=this.doc.resolve(t);o=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,o)),this.selection.empty||this.setSelection(s.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function w(e,t){return t&&e?e.bind(t):e}class S{constructor(e,t,n){this.name=e,this.init=w(t.init,n),this.apply=w(t.apply,n)}}let b=[new S("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new S("selection",{init:(e,t)=>e.selection||s.atStart(t.doc),apply:e=>e.selection}),new S("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,r)=>r.selection.$cursor?e.storedMarks:null}),new S("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class I{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=b.slice(),t&&t.forEach(e=>{if(this.pluginsByKey[e.key])throw RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new S(e.key,e.spec.state,e))})}}class x{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let o=!1;for(let i=0;i<this.config.plugins.length;i++){let s=this.config.plugins[i];if(s.spec.appendTransaction){let l=r?r[i].n:0,c=r?r[i].state:this,a=l<t.length&&s.spec.appendTransaction.call(s,l?t.slice(l):t,c,n);if(a&&n.filterTransaction(a,i)){if(a.setMeta("appendedTransaction",e),!r){r=[];for(let e=0;e<this.config.plugins.length;e++)r.push(e<i?{state:n,n:t.length}:{state:this,n:0})}t.push(a),n=n.applyInner(a),o=!0}r&&(r[i]={state:n,n:t.length})}}if(!o)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw RangeError("Applying a mismatched transaction");let t=new x(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let o=n[r];t[o.name]=o.apply(e,this[o.name],this,t)}return t}get tr(){return new k(this)}static create(e){let t=new I(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new x(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new I(this.schema,e.plugins),n=t.fields,r=new x(t);for(let t=0;t<n.length;t++){let o=n[t].name;r[o]=this.hasOwnProperty(o)?this[o]:n[t].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(e=>e.toJSON())),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],o=r.spec.state;o&&o.toJSON&&(t[n]=o.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw RangeError("Required config field 'schema' missing");let o=new I(e.schema,e.plugins),i=new x(o);return o.fields.forEach(o=>{if("doc"==o.name)i.doc=r.bP.fromJSON(e.schema,t.doc);else if("selection"==o.name)i.selection=s.fromJSON(i.doc,t.selection);else if("storedMarks"==o.name)t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let r in n){let s=n[r],l=s.spec.state;if(s.key==o.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(t,r)){i[o.name]=l.fromJSON.call(s,e,t[r],i);return}}i[o.name]=o.init(e,i)}}),i}}class v{constructor(e){this.spec=e,this.props={},e.props&&function e(t,n,r){for(let o in t){let i=t[o];i instanceof Function?i=i.bind(n):"handleDOMEvents"==o&&(i=e(i,n,{})),r[o]=i}return r}(e.props,this,this.props),this.key=e.key?e.key.key:C("plugin")}getState(e){return e[this.key]}}let $=Object.create(null);function C(e){return e in $?e+"$"+ ++$[e]:($[e]=0,e+"$")}class M{constructor(e="key"){this.key=C(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}}}]);